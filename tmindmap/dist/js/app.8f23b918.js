(function(){"use strict";var t={8245:function(t,e,o){var a=o(5130),n=o(6768);const s={id:"app"};function i(t,e,o,a,i,r){const l=(0,n.g2)("AppHeader"),d=(0,n.g2)("router-view"),c=(0,n.g2)("AppFooter");return(0,n.uX)(),(0,n.CE)("div",s,[(0,n.bF)(l),(0,n.Lk)("main",null,[(0,n.bF)(d)]),(0,n.bF)(c)])}var r=o(4232),l=o.p+"img/TMIND.c8f3d8ff.png";const d={class:"nav"},c={class:"logo"},h={class:"list",id:"navList"},u={class:"list_mm"},p={class:"about"},m={class:"feedback"},g={key:0,class:"signin"},f={key:1,class:"signup"},k=["src"],y={class:"user-name"},b={key:3,class:"user-menu"},x={class:"modal-overlay",id:"feedbackModal"},L={class:"modal-content"},v={class:"modal-header"},w={class:"modal-body"},C={class:"form-group"},M={class:"form-group checkbox-group"},N={key:0,class:"modal-overlay",style:{display:"flex !important","z-index":"9999"}},S={class:"modal-content"},I={class:"modal-header"},T={class:"modal-body"},$={class:"form-group infor"},A={class:"form-group infor"},E={class:"form-group infor"};function P(t,e,o,s,i,P){const B=(0,n.g2)("router-link");return(0,n.uX)(),(0,n.CE)(n.FK,null,[(0,n.Lk)("header",null,[(0,n.Lk)("div",d,[(0,n.Lk)("div",c,[(0,n.bF)(B,{to:"/"},{default:(0,n.k6)((()=>e[17]||(e[17]=[(0,n.Lk)("img",{src:l,alt:"logo"},null,-1)]))),_:1})]),(0,n.Lk)("div",h,[(0,n.Lk)("div",u,[(0,n.Lk)("a",{href:"#",onClick:e[0]||(e[0]=(0,a.D$)(((...t)=>P.goToListMindMap&&P.goToListMindMap(...t)),["prevent"]))},"LIST MINDMAP")]),(0,n.Lk)("div",p,[(0,n.bF)(B,{to:"/#about"},{default:(0,n.k6)((()=>e[18]||(e[18]=[(0,n.eW)("ABOUT")]))),_:1})]),(0,n.Lk)("div",m,[(0,n.Lk)("a",{href:"#",onClick:e[1]||(e[1]=(0,a.D$)(((...t)=>P.openModal&&P.openModal(...t)),["prevent"]))},"FEEDBACK")]),P.isLoggedIn?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.CE)("div",g,[(0,n.bF)(B,{to:"/signin"},{default:(0,n.k6)((()=>e[19]||(e[19]=[(0,n.eW)("SIGN IN")]))),_:1})])),P.isLoggedIn?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.CE)("div",f,[(0,n.bF)(B,{to:"/signup"},{default:(0,n.k6)((()=>e[20]||(e[20]=[(0,n.eW)("SIGN UP")]))),_:1})])),P.isLoggedIn?((0,n.uX)(),(0,n.CE)("div",{key:2,class:"user-info",onClick:e[2]||(e[2]=(...t)=>P.toggleUserMenu&&P.toggleUserMenu(...t))},[(0,n.Lk)("img",{src:P.userIcon,alt:"User Icon",class:"user-icon"},null,8,k),(0,n.Lk)("span",y,(0,r.v_)(P.userName),1)])):(0,n.Q3)("",!0),i.showUserMenu?((0,n.uX)(),(0,n.CE)("div",b,[(0,n.Lk)("button",{onClick:e[3]||(e[3]=(...t)=>P.openAccountModal&&P.openAccountModal(...t))},"Thông tin tài khoản"),(0,n.Lk)("button",{onClick:e[4]||(e[4]=(...t)=>P.logout&&P.logout(...t))},"Đăng xuất")])):(0,n.Q3)("",!0)]),(0,n.Lk)("button",{class:"menu",onClick:e[5]||(e[5]=(...t)=>P.openMenu&&P.openMenu(...t))},e[21]||(e[21]=[(0,n.Lk)("i",{class:"fa-solid fa-bars"},null,-1)])),(0,n.Lk)("button",{class:"close_menu",onClick:e[6]||(e[6]=(...t)=>P.closeMenu&&P.closeMenu(...t))},e[22]||(e[22]=[(0,n.Lk)("i",{class:"fa-solid fa-xmark"},null,-1)]))])]),(0,n.Lk)("div",x,[(0,n.Lk)("div",L,[(0,n.Lk)("div",v,[e[23]||(e[23]=(0,n.Lk)("h2",null,"Gửi Phản Hồi",-1)),(0,n.Lk)("span",{class:"close-button",onClick:e[7]||(e[7]=(...t)=>P.closeModal&&P.closeModal(...t))},"×")]),(0,n.Lk)("div",w,[(0,n.Lk)("form",{onSubmit:e[11]||(e[11]=(0,a.D$)(((...t)=>P.Feedback&&P.Feedback(...t)),["prevent"]))},[(0,n.Lk)("div",C,[e[24]||(e[24]=(0,n.Lk)("label",{for:"description"},"Mô Tả",-1)),(0,n.bo)((0,n.Lk)("textarea",{id:"description","onUpdate:modelValue":e[8]||(e[8]=t=>i.feedbackDescription=t),name:"description",placeholder:"Mô tả chi tiết vấn đề ở đây"},null,512),[[a.Jo,i.feedbackDescription]])]),(0,n.Lk)("div",M,[(0,n.bo)((0,n.Lk)("input",{type:"checkbox",id:"include-ai-session","onUpdate:modelValue":e[9]||(e[9]=t=>i.includeAiSession=t),name:"include-ai-session",checked:""},null,512),[[a.lH,i.includeAiSession]]),e[25]||(e[25]=(0,n.Lk)("label",{for:"include-ai-session"},"Bao gồm phiên làm việc ứng dụng cuối cùng trong phản hồi.",-1))]),(0,n.Lk)("button",{type:"submit",class:"submit-button",onClick:e[10]||(e[10]=(...t)=>P.sendFeedback&&P.sendFeedback(...t))},"Gửi đi")],32),e[26]||(e[26]=(0,n.Lk)("p",{class:"footer-text"},[(0,n.eW)(" Để có câu trả lời nhanh chóng, hãy liên hệ với chúng tôi qua "),(0,n.Lk)("a",{href:"mailto:dtc21h4802010284@ictu.edu.vn"},"dtc21h4802010284@ictu.edu.vn")],-1))])])]),i.isAccountModalOpen?((0,n.uX)(),(0,n.CE)("div",N,[(0,n.Lk)("div",S,[(0,n.Lk)("div",I,[e[27]||(e[27]=(0,n.Lk)("h2",null,"THÔNG TIN TÀI KHOẢN",-1)),(0,n.Lk)("span",{class:"close-button",onClick:e[12]||(e[12]=(...t)=>P.closeAccountModal&&P.closeAccountModal(...t))},"×")]),(0,n.Lk)("div",T,[(0,n.Lk)("form",{onSubmit:e[16]||(e[16]=(0,a.D$)(((...t)=>P.saveAccountInfo&&P.saveAccountInfo(...t)),["prevent"]))},[(0,n.Lk)("div",$,[e[28]||(e[28]=(0,n.Lk)("label",{for:"accountName"},"Tên:",-1)),(0,n.bo)((0,n.Lk)("input",{type:"text",id:"accountName","onUpdate:modelValue":e[13]||(e[13]=t=>i.account.name=t),placeholder:"Nhập tên"},null,512),[[a.Jo,i.account.name]])]),(0,n.Lk)("div",A,[e[29]||(e[29]=(0,n.Lk)("label",{for:"accountEmail"},"Email:",-1)),(0,n.bo)((0,n.Lk)("input",{type:"email",id:"accountEmail","onUpdate:modelValue":e[14]||(e[14]=t=>i.account.email=t),placeholder:"Nhập email",disabled:""},null,512),[[a.Jo,i.account.email]])]),(0,n.Lk)("div",E,[e[30]||(e[30]=(0,n.Lk)("label",{for:"accountPhone"},"Số điện thoại:",-1)),(0,n.bo)((0,n.Lk)("input",{type:"text",id:"accountPhone","onUpdate:modelValue":e[15]||(e[15]=t=>i.account.phone=t),placeholder:"Nhập số điện thoại"},null,512),[[a.Jo,i.account.phone]])]),e[31]||(e[31]=(0,n.Lk)("button",{type:"submit",class:"submit-button"},"Lưu thông tin",-1))],32)])])])):(0,n.Q3)("",!0)],64)}o(4114);var B=o(144);const F=(0,B.Kh)({token:localStorage.getItem("token")||"",userName:localStorage.getItem("userName")||"",userIcon:localStorage.getItem("userIcon")||""});var z=o(3831),O=o(6400);const D={apiKey:"AIzaSyCATjuZ6o54hp-P84lnS6n_o9dGyFH1_8g",authDomain:"mindmap-ad6dd.firebaseapp.com",projectId:"mindmap-ad6dd",storageBucket:"mindmap-ad6dd.firebasestorage.app",messagingSenderId:"882676772255",appId:"1:882676772255:web:dcb692696274d65ab261aa",measurementId:"G-N7T0R2DJ2S"},W=(0,O.Wp)(D),U=(0,z.xI)(W),j=new z.HF,_=new z.sk;var X={name:"AppHeader",computed:{isLoggedIn(){return!!F.token},userName(){return F.userName||"User"},userIcon(){return F.userIcon||o(9413)}},data(){return{showUserMenu:!1,isAccountModalOpen:!1,account:{name:"",email:"",phone:""},feedbackDescription:"",includeAiSession:!0}},methods:{goToListMindMap(){this.isLoggedIn?this.$router.push("/listmm"):this.$router.push("/signin")},openModal(){this.isLoggedIn?document.getElementById("feedbackModal").style.display="flex":this.$router.push("/signin")},closeModal(){document.getElementById("feedbackModal").style.display="none"},Feedback(){this.isLoggedIn?(console.log("Feedback gửi:",this.feedbackDescription,this.includeAiSession),this.closeModal()):this.$router.push("/signin")},toggleUserMenu(){this.showUserMenu=!this.showUserMenu},async openAccountModal(){try{const t=localStorage.getItem("token");if(!t)throw new Error("Chưa có token, vui lòng đăng nhập lại");console.log("Using token:",t);const e=await fetch("/profile",{method:"GET",headers:{Authorization:`Bearer ${t}`,Accept:"application/json"}});if(401===e.status)return void this.$router.push("/signin");if(!e.ok)throw new Error(`Unexpected status ${e.status}`);const o=await e.json(),a=o.user??o;this.account={name:a.name,email:a.email,phone:a.phone},this.isAccountModalOpen=!0}catch(t){console.error("Failed to open account modal:",t)}},closeAccountModal(){this.isAccountModalOpen=!1},async saveAccountInfo(){try{const t=localStorage.getItem("token"),e=await fetch("/profile",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({name:this.account.name,phone:this.account.phone})});if(!e.ok){const t=await e.json();throw new Error(t.message||`Error ${e.status}`)}const{user:o}=await e.json();this.account.name=o.name,this.account.phone=o.phone,this.isAccountModalOpen=!1,alert("Cập nhật thành công!")}catch(t){console.error("Save profile failed:",t)}},async logout(){try{await(0,z.CI)(U),F.token=null,F.userName="",F.userIcon="",localStorage.removeItem("token"),localStorage.removeItem("userName"),localStorage.removeItem("userIcon"),this.$router.push("/signin"),this.showUserMenu=!1}catch(t){console.error("Logout lỗi:",t)}},openMenu(){window.innerWidth<=768&&(document.querySelector(".list").style.display="block",document.querySelector(".close_menu").style.display="block",document.querySelector(".menu").style.display="none")},closeMenu(){window.innerWidth<=768&&(document.querySelector(".list").style.display="none",document.querySelector(".close_menu").style.display="none",document.querySelector(".menu").style.display="block")},sendFeedback(){const t={name:localStorage.getItem("userName")||"Anonymous",email:localStorage.getItem("userEmail")||"unknown@example.com",content:this.feedbackDescription};fetch("/feedback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((t=>{if(!t.ok)throw new Error("Server response was not OK");return alert("Đã gửi phản hồi thành công"),t.json()})).then((t=>{console.log("Feedback gửi:",t),this.successMessage=t.message,setTimeout((()=>this.closeModal()),2e3)})).catch((t=>{console.error("Lỗi khi gửi feedback:",t),this.errorMessage="Lỗi khi gửi phản hồi!"}))}},mounted(){window.addEventListener("resize",(()=>{const t=document.querySelector(".list");window.innerWidth>768?(t.style.display="flex",document.querySelector(".menu").style.display="none"):(t.style.display="none",document.querySelector(".menu").style.display="block")}))}},R=o(1241);const J=(0,R.A)(X,[["render",P],["__scopeId","data-v-f727c448"]]);var H=J;function V(t,e,o,a,s,i){return(0,n.uX)(),(0,n.CE)("footer",null,e[0]||(e[0]=[(0,n.Lk)("div",{class:"footer_bottom"},"© 2025 Copyright of TMIND MAP",-1)]))}var G={name:"AppFooter"};const q=(0,R.A)(G,[["render",V],["__scopeId","data-v-3dcc20c8"]]);var Y=q,K={name:"App",components:{AppHeader:H,AppFooter:Y}};const Q=(0,R.A)(K,[["render",i]]);var Z=Q,tt=o(2261),et=o(1387),ot=o.p+"img/tmind.8d7dd630.gif";const at={class:"container"},nt={class:"body"},st={class:"btn_design_mm"},it={class:"btn_design_mm_ai"};function rt(t,e,o,a,s,i){const r=(0,n.g2)("router-link");return(0,n.uX)(),(0,n.CE)("div",at,[(0,n.Lk)("div",nt,[e[2]||(e[2]=(0,n.Lk)("p",null,[(0,n.eW)(" Tạo và xuất "),(0,n.Lk)("span",{id:"word1",class:"word"},"hình ảnh"),(0,n.Lk)("span",{id:"word2",class:"word",style:{display:"none"}},"PowerPoint"),(0,n.eW)(" sơ đồ tư duy chỉ với một cú nhấp bằng AI "),(0,n.Lk)("br"),(0,n.eW)(" Thể hiện trí thông minh và khả năng sáng tạo với cách tự tạo sơ đồ tư duy ")],-1)),(0,n.Lk)("button",st,[(0,n.bF)(r,{to:"/createMM"},{default:(0,n.k6)((()=>e[0]||(e[0]=[(0,n.eW)("Tạo sơ đồ tư duy")]))),_:1})]),(0,n.Lk)("button",it,[(0,n.bF)(r,{to:"/createMMAI"},{default:(0,n.k6)((()=>e[1]||(e[1]=[(0,n.eW)("Tạo sơ đồ tư duy AI")]))),_:1})])]),e[3]||(e[3]=(0,n.Fv)('<div id="about" data-v-e79fe2c4><img src="'+ot+'" alt="mindmap" data-v-e79fe2c4><p data-v-e79fe2c4> - Với <b data-v-e79fe2c4>TMINDMAP</b>, nơi biến những ý tưởng, chủ đề của bạn thành sơ đồ tư duy nhanh chóng với AI. Nếu AI tạo mà còn thiếu sót hoặc chưa hoàn chỉnh lắm, người dùng có thể chỉnh sửa để hoàn chỉnh nhất. <br data-v-e79fe2c4> - <b data-v-e79fe2c4>TMINDMAP</b> còn giúp bạn thể hiện sự sáng tạo đỉnh cao của mình với một cái đầu thông minh để tạo nên những sơ đồ tư duy hoàn hảo. <br data-v-e79fe2c4> - Hỗ trợ xuất ra hình ảnh hoặc PowerPoint để giúp việc thuyết trình dễ dàng hơn. <br data-v-e79fe2c4> - Hy vọng <b data-v-e79fe2c4>TMINDMAP</b> sẽ là người bạn đồng hành cho bài thuyết trình, báo cáo, bài giảng,... <br data-v-e79fe2c4> - Đối tượng chính của <b data-v-e79fe2c4>TMINDMAP</b> là giáo viên, học sinh và sinh viên. <br data-v-e79fe2c4> - Nếu có bất kỳ góp ý, đánh giá nào, hãy gửi phản hồi cho chúng tôi qua trang feedback. <br data-v-e79fe2c4> - Cảm ơn mọi người đã tin tưởng và sử dụng! </p></div><footer data-v-e79fe2c4><div class="footer_top" data-v-e79fe2c4><div class="footer_top-left" data-v-e79fe2c4><img src="'+l+'" alt="TMINDMAP" data-v-e79fe2c4><p data-v-e79fe2c4> Tự thiết kế với sáng tạo của chính mình hoặc <br data-v-e79fe2c4> nhờ AI biến thành sơ đồ tư duy chỉ trong vài phút. </p></div><div class="footer_top-right" data-v-e79fe2c4><h1 data-v-e79fe2c4>TÍNH NĂNG</h1><ul data-v-e79fe2c4><li data-v-e79fe2c4>Quản lý và tìm kiếm sơ đồ tư duy đã tạo</li><li data-v-e79fe2c4>Tự thiết kế sơ đồ tư duy</li><li data-v-e79fe2c4>Thiết kế sơ đồ tư duy bằng AI</li><li data-v-e79fe2c4>Xuất sơ đồ tư duy bằng hình ảnh hoặc PowerPoint</li><li data-v-e79fe2c4>Chọn template cho sơ đồ tư duy</li></ul></div></div></footer>',2))])}var lt={name:"HomeMindMap",mounted(){this.startWordAnimation()},methods:{startWordAnimation(){let t=!0;setInterval((()=>{const e=document.getElementById("word1"),o=document.getElementById("word2");e&&o&&(t?(e.style.display="none",o.style.display="inline-block",o.classList.remove("word"),o.offsetWidth,o.classList.add("word")):(o.style.display="none",e.style.display="inline-block",e.classList.remove("word"),e.offsetWidth,e.classList.add("word")),t=!t)}),3e3)}}};const dt=(0,R.A)(lt,[["render",rt],["__scopeId","data-v-e79fe2c4"]]);var ct=dt;const ht={class:"toollist"},ut={class:"toolbar_list-left"},pt={class:"search_list"},mt={class:"toolbar_list-right"},gt={key:0,class:"loading"},ft={key:1},kt=["src"],yt={class:"listmm-content"},bt={class:"title"},xt=["onClick"],Lt={key:0,class:"no-data"};function vt(t,e,o,s,i,l){const d=(0,n.g2)("router-link");return(0,n.uX)(),(0,n.CE)("div",null,[(0,n.Lk)("div",ht,[(0,n.Lk)("div",ut,[(0,n.bF)(d,{to:"/createMM"},{default:(0,n.k6)((()=>e[3]||(e[3]=[(0,n.Lk)("button",{class:"btn-primary"},[(0,n.Lk)("span",null,"«"),(0,n.eW)(" Tự tạo sơ đồ tư duy ")],-1)]))),_:1})]),(0,n.Lk)("div",pt,[(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>i.searchTerm=t),onInput:e[1]||(e[1]=(...t)=>l.filterList&&l.filterList(...t)),type:"text",placeholder:"Nhập tên sơ đồ tư duy cần tìm..."},null,544),[[a.Jo,i.searchTerm]]),(0,n.Lk)("button",{class:"btn-search",onClick:e[2]||(e[2]=(...t)=>l.filterList&&l.filterList(...t))},e[4]||(e[4]=[(0,n.Lk)("i",{class:"fa-solid fa-magnifying-glass"},null,-1)]))]),(0,n.Lk)("div",mt,[(0,n.bF)(d,{to:"/createMMAI"},{default:(0,n.k6)((()=>e[5]||(e[5]=[(0,n.Lk)("button",{class:"btn-secondary"},[(0,n.eW)(" Tạo sơ đồ tư duy AI "),(0,n.Lk)("span",null,"»")],-1)]))),_:1})])]),i.loading?((0,n.uX)(),(0,n.CE)("div",gt,"Đang tải...")):((0,n.uX)(),(0,n.CE)("div",ft,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(i.filteredList,(t=>((0,n.uX)(),(0,n.CE)("div",{key:t._id,class:"listmm"},[(0,n.bF)(d,{to:`/createmm/edit/${t._id}`,class:"itemmm"},{default:(0,n.k6)((()=>[(0,n.Lk)("img",{src:t.imageUrl,alt:"Mindmap"},null,8,kt),(0,n.Lk)("div",yt,[(0,n.Lk)("h3",bt,(0,r.v_)(t.title),1),(0,n.Lk)("small",null,"Ngày tạo: "+(0,r.v_)(l.formatDate(t.createdAt)),1)])])),_:2},1032,["to"]),(0,n.Lk)("div",{class:"list_delete",onClick:e=>l.deleteItem(t._id)},e[6]||(e[6]=[(0,n.Lk)("i",{class:"fa-solid fa-trash"},null,-1)]),8,xt)])))),128)),i.filteredList.length?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.CE)("div",Lt," Không tìm thấy sơ đồ tư duy. "))]))])}o(8111),o(2489);var wt={name:"MindMapList",data(){return{list:[],filteredList:[],searchTerm:"",loading:!1}},mounted(){this.fetchList()},methods:{async fetchList(){this.loading=!0;try{let t;const e=localStorage.getItem("provider");if(console.log(e),"google"===e){const e=(0,z.xI)(),o=e.currentUser;if(!o)throw new Error("Chưa đăng nhập Firebase");t=await o.getIdToken(!0)}else if(t=localStorage.getItem("token"),!t)throw new Error("Chưa đăng nhập hệ thống");const o=await fetch("/api/listMindmap/Listmm",{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(401===o.status)throw new Error("Không có quyền hoặc token hết hạn");if(!o.ok)throw new Error(await o.text());const{list:a}=await o.json();this.list=a,this.filteredList=a}catch(t){alert("Lỗi khi tải danh sách: "+t.message)}finally{this.loading=!1}},filterList(){const t=this.searchTerm.trim().toLowerCase();this.filteredList=t?this.list.filter((e=>e.title.toLowerCase().includes(t))):this.list},async deleteItem(t){if(confirm("Bạn có chắc muốn xóa sơ đồ này?"))try{let e;const o=localStorage.getItem("provider");if(console.log(o),"google"===o){const t=(0,z.xI)(),o=t.currentUser;if(!o)throw new Error("Chưa đăng nhập Firebase");e=await o.getIdToken(!0)}else if(e=localStorage.getItem("token"),!e)throw new Error("Chưa đăng nhập hệ thống");const a=await fetch(`/api/listMindmap/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${e}`}});if(!a.ok)throw new Error(await a.text());this.list=this.list.filter((e=>e._id!==t)),this.filterList()}catch(e){alert("Lỗi khi xóa: "+e.message)}},formatDate(t){const e=new Date(t);return e.toLocaleDateString()+" "+e.toLocaleTimeString()}}};const Ct=(0,R.A)(wt,[["render",vt],["__scopeId","data-v-b7ebff58"]]);var Mt=Ct;o(9314);const Nt={class:"mindmap-container"},St={class:"toolbar"},It={class:"toolbar-left"},Tt={class:"toolbar-right"},$t={key:0,class:"modal-backdrop"},At={class:"modal"},Et={class:"modal-actions"},Pt={class:"content"},Bt={class:"left-panel"},Ft={class:"node-shapes"},zt={class:"shape"},Ot={class:"text-formatting"},Dt={class:"fomat"},Wt={class:"node-style"},Ut={class:"style-group-node"},jt={class:"link-style"},_t={class:"style-group"},Xt={class:"style-group"},Rt={class:"style-group"},Jt={class:"style-group"},Ht={class:"link-canvas",ref:"canva",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},Vt=["onClick"],Gt=["onClick","d","fill"],qt=["onClick","id","d","stroke","stroke-width"],Yt=["onClick","d","stroke","stroke-width","stroke-dasharray","marker-end"],Kt=["cx","cy","onMousedown"],Qt=["x1","y1","x2","y2","stroke","stroke-width","stroke-dasharray","marker-end","onClick"],Zt=["d","stroke","stroke-width","stroke-dasharray","marker-end","onClick"],te=["cx","cy","onMousedown"],ee=["onDblclick"],oe=["xlink:href","text-anchor","font-weight","font-style","fill","font-family","font-size"],ae=["x","y"],ne=["onKeydown","onBlur"],se=["x1","y1","x2","y2"],ie=["data-id","onMousedown","onClick"],re=["onMousedown"],le=["onMousedown"],de=["contenteditable","onBlur"],ce=["src"],he=["innerHTML"],ue=["onMousedown"],pe=["onMousedown"],me=["onMousedown"],ge=["onMousedown"],fe=["onMousedown"],ke=["onMousedown"],ye=["onMousedown"],be=["onMousedown"];function xe(t,e,o,s,i,l){return(0,n.uX)(),(0,n.CE)("div",Nt,[(0,n.Lk)("div",St,[(0,n.Lk)("div",It,[(0,n.Lk)("button",{class:"toolbar-btn",onClick:e[0]||(e[0]=t=>l.zoomIn())},e[52]||(e[52]=[(0,n.Lk)("i",{class:"fa-solid fa-search-plus"},null,-1)])),(0,n.Lk)("button",{class:"toolbar-btn",onClick:e[1]||(e[1]=t=>l.zoomOut())},e[53]||(e[53]=[(0,n.Lk)("i",{class:"fa-solid fa-search-minus"},null,-1)])),(0,n.Lk)("button",{class:"toolbar-btn",onClick:e[2]||(e[2]=t=>l.undo())},e[54]||(e[54]=[(0,n.Lk)("i",{class:"fa-solid fa-rotate-left"},null,-1)])),(0,n.Lk)("button",{class:"toolbar-btn",onClick:e[3]||(e[3]=t=>l.redo())},e[55]||(e[55]=[(0,n.Lk)("i",{class:"fa-solid fa-rotate-right"},null,-1)])),(0,n.Lk)("button",{class:"toolbar-btn",onClick:e[4]||(e[4]=t=>l.removeNode())},e[56]||(e[56]=[(0,n.Lk)("i",{class:"fa-solid fa-trash"},null,-1)])),(0,n.Lk)("button",{class:"toolbar-btn",onClick:e[5]||(e[5]=t=>l.uploadImage())},e[57]||(e[57]=[(0,n.Lk)("i",{class:"fa-solid fa-upload"},null,-1)]))]),(0,n.Lk)("div",Tt,[(0,n.Lk)("button",{class:"toolbar-btn",onClick:e[6]||(e[6]=(...t)=>l.exportImage&&l.exportImage(...t))},e[58]||(e[58]=[(0,n.Lk)("i",{class:"fa-solid fa-image"},null,-1),(0,n.Lk)("span",null,"Xuất hình ảnh",-1)])),(0,n.Lk)("button",{class:"toolbar-btn",onClick:e[7]||(e[7]=(...t)=>l.exportPPT&&l.exportPPT(...t))},e[59]||(e[59]=[(0,n.Lk)("i",{class:"fa-solid fa-file-powerpoint"},null,-1),(0,n.Lk)("span",null,"Xuất PPT",-1)])),(0,n.Lk)("button",{onClick:e[8]||(e[8]=(...t)=>l.openModal&&l.openModal(...t)),class:"toolbar-btn"},[e[60]||(e[60]=(0,n.Lk)("i",{class:"fa-solid fa-floppy-disk"},null,-1)),(0,n.Lk)("span",null,(0,r.v_)(l.isEditing?"Cập nhật":"Lưu sơ đồ"),1)]),e[61]||(e[61]=(0,n.Lk)("button",{class:"toolbar-btn ai-button"},[(0,n.Lk)("a",{href:"/createMMAI"},[(0,n.Lk)("i",{class:"fa-solid fa-robot"}),(0,n.Lk)("span",null,"TẠO VỚI AI")])],-1))])]),i.showModal?((0,n.uX)(),(0,n.CE)("div",$t,[(0,n.Lk)("div",At,[e[62]||(e[62]=(0,n.Lk)("h3",null,"Đặt tên sơ đồ tư duy",-1)),(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":e[9]||(e[9]=t=>i.form.mapTitle=t),placeholder:"Tên sơ đồ tư duy"},null,512),[[a.Jo,i.form.mapTitle]]),(0,n.Lk)("div",Et,[(0,n.Lk)("button",{onClick:e[10]||(e[10]=(...t)=>l._postSaveManual&&l._postSaveManual(...t))},"Lưu"),(0,n.Lk)("button",{onClick:e[11]||(e[11]=(...t)=>l.closeModal&&l.closeModal(...t))},"Huỷ")])])])):(0,n.Q3)("",!0),(0,n.Lk)("input",{type:"file",id:"imageUploader",accept:"image/*",style:{display:"none"},onChange:e[12]||(e[12]=(...t)=>l.handleFileSelect&&l.handleFileSelect(...t))},null,32),(0,n.Lk)("div",Pt,[(0,n.Lk)("div",Bt,[(0,n.Lk)("div",Ft,[e[66]||(e[66]=(0,n.Lk)("h3",null,[(0,n.Lk)("i",{class:"fa-solid fa-shapes"}),(0,n.eW)(" Hình dạng")],-1)),(0,n.Lk)("div",zt,[(0,n.Lk)("div",{class:"shape-option",draggable:"true",onDragstart:e[13]||(e[13]=t=>l.dragStart("rectangle"))},e[63]||(e[63]=[(0,n.Lk)("i",{class:"fa-solid fa-square"},null,-1)]),32),(0,n.Lk)("div",{class:"shape-option",draggable:"true",onDragstart:e[14]||(e[14]=t=>l.dragStart("circle"))},e[64]||(e[64]=[(0,n.Lk)("i",{class:"fa-solid fa-circle"},null,-1)]),32),(0,n.Lk)("div",{class:"shape-option",draggable:"true",onDragstart:e[15]||(e[15]=t=>l.dragStart("label"))},e[65]||(e[65]=[(0,n.Lk)("i",{class:"fa-solid fa-tag"},null,-1)]),32)])]),(0,n.Lk)("div",Ot,[e[73]||(e[73]=(0,n.Lk)("h3",null,[(0,n.Lk)("i",{class:"fa-solid fa-text-height"}),(0,n.eW)(" Kiểu chữ")],-1)),(0,n.Lk)("div",Dt,[(0,n.Lk)("button",{class:(0,r.C4)(["format-btn",{active:i.selectedNode&&i.selectedNode.isBold||i.selectedLink&&i.selectedLink.isBold}]),onClick:e[16]||(e[16]=(...t)=>l.toggleBold&&l.toggleBold(...t))},e[67]||(e[67]=[(0,n.Lk)("i",{class:"fa-solid fa-bold"},null,-1)]),2),(0,n.Lk)("button",{class:(0,r.C4)(["format-btn",{active:i.selectedNode&&i.selectedNode.isItalic||i.selectedLink&&i.selectedLink.isItalic}]),onClick:e[17]||(e[17]=(...t)=>l.toggleItalic&&l.toggleItalic(...t))},e[68]||(e[68]=[(0,n.Lk)("i",{class:"fa-solid fa-italic"},null,-1)]),2),(0,n.Lk)("button",{class:(0,r.C4)(["format-btn",{active:i.selectedNode&&"left"===i.selectedNode.align||i.selectedLink&&"start"===i.selectedLink.align}]),onClick:e[18]||(e[18]=t=>l.setAlign("left"))},e[69]||(e[69]=[(0,n.Lk)("i",{class:"fa-solid fa-align-left"},null,-1)]),2),(0,n.Lk)("button",{class:(0,r.C4)(["format-btn",{active:i.selectedNode&&"center"===i.selectedNode.align||i.selectedLink&&"middle"===i.selectedLink.align}]),onClick:e[19]||(e[19]=t=>l.setAlign("center"))},e[70]||(e[70]=[(0,n.Lk)("i",{class:"fa-solid fa-align-center"},null,-1)]),2),(0,n.Lk)("button",{class:(0,r.C4)(["format-btn",{active:i.selectedNode&&"right"===i.selectedNode.align||i.selectedLink&&"end"===i.selectedLink.align}]),onClick:e[20]||(e[20]=t=>l.setAlign("right"))},e[71]||(e[71]=[(0,n.Lk)("i",{class:"fa-solid fa-align-right"},null,-1)]),2),(0,n.bo)((0,n.Lk)("input",{type:"color","onUpdate:modelValue":e[21]||(e[21]=t=>i.selectedColor=t),onChange:e[22]||(e[22]=(...t)=>l.applyTextColor&&l.applyTextColor(...t)),class:"color-picker",title:"Màu chữ"},null,544),[[a.Jo,i.selectedColor]]),(0,n.bo)((0,n.Lk)("input",{type:"number","onUpdate:modelValue":e[23]||(e[23]=t=>i.selectedFontSize=t),onChange:e[24]||(e[24]=(...t)=>l.applyFontSize&&l.applyFontSize(...t)),class:"font-size-input",min:"6",max:"72",style:{width:"40px","margin-left":"8px",border:"2px solid #ccc","border-radius":"10px"},title:"Kích thước chữ (px)"},null,544),[[a.Jo,i.selectedFontSize,void 0,{number:!0}]])]),(0,n.bo)((0,n.Lk)("select",{"onUpdate:modelValue":e[25]||(e[25]=t=>i.selectedFont=t),onChange:e[26]||(e[26]=(...t)=>l.applyFontFamily&&l.applyFontFamily(...t)),class:"style-select"},e[72]||(e[72]=[(0,n.Lk)("option",{value:""},"Font",-1),(0,n.Lk)("option",{value:"Arial"},"Arial",-1),(0,n.Lk)("option",{value:"Times New Roman"},"Times New Roman",-1),(0,n.Lk)("option",{value:"Courier New"},"Courier New",-1)]),544),[[a.u1,i.selectedFont]])]),e[79]||(e[79]=(0,n.Lk)("h3",null,[(0,n.Lk)("i",{class:"fa-solid fa-paintbrush"}),(0,n.eW)(" Style Node")],-1)),(0,n.Lk)("div",Wt,[(0,n.Lk)("div",Ut,[(0,n.bo)((0,n.Lk)("input",{type:"color","onUpdate:modelValue":e[27]||(e[27]=t=>l.nodeBorderColor=t),onChange:e[28]||(e[28]=t=>l.updateNode(i.selectedNode)),class:"color-picker",title:"Màu viền"},null,544),[[a.Jo,l.nodeBorderColor]]),(0,n.bo)((0,n.Lk)("input",{type:"color","onUpdate:modelValue":e[29]||(e[29]=t=>l.nodeBackgroundColor=t),onChange:e[30]||(e[30]=t=>l.updateNode(i.selectedNode)),class:"color-picker",title:"Màu nền"},null,544),[[a.Jo,l.nodeBackgroundColor]]),(0,n.bo)((0,n.Lk)("input",{type:"number","onUpdate:modelValue":e[31]||(e[31]=t=>l.nodeBorderThickness=t),min:"1",onInput:e[32]||(e[32]=t=>l.updateNode(i.selectedNode)),class:"number-input"},null,544),[[a.Jo,l.nodeBorderThickness,void 0,{number:!0}]]),(0,n.bo)((0,n.Lk)("select",{"onUpdate:modelValue":e[33]||(e[33]=t=>l.nodeBorderStyle=t),onChange:e[34]||(e[34]=t=>l.updateNode(i.selectedNode)),class:"style-select"},e[74]||(e[74]=[(0,n.Lk)("option",{value:"solid"},"Solid",-1),(0,n.Lk)("option",{value:"dashed"},"Dashed",-1),(0,n.Lk)("option",{value:"dotted"},"Dotted",-1)]),544),[[a.u1,l.nodeBorderStyle]])])]),(0,n.Lk)("div",jt,[e[78]||(e[78]=(0,n.Lk)("h3",null,[(0,n.Lk)("i",{class:"fa-solid fa-sitemap"}),(0,n.eW)(" Style Link")],-1)),(0,n.Lk)("div",_t,[(0,n.bo)((0,n.Lk)("input",{type:"color","onUpdate:modelValue":e[35]||(e[35]=t=>l.linkColor=t),onChange:e[36]||(e[36]=t=>l.updateLink(i.selectedLink)),class:"color-picker",title:"Màu liên kết"},null,544),[[a.Jo,l.linkColor]]),(0,n.bo)((0,n.Lk)("input",{type:"number",min:"1","onUpdate:modelValue":e[37]||(e[37]=t=>l.linkThickness=t),onChange:e[38]||(e[38]=t=>l.updateLink(i.selectedLink)),class:"number-input"},null,544),[[a.Jo,l.linkThickness,void 0,{number:!0}]])]),(0,n.Lk)("div",Xt,[(0,n.bo)((0,n.Lk)("select",{"onUpdate:modelValue":e[39]||(e[39]=t=>l.linkDash=t),class:"style-select",onChange:e[40]||(e[40]=t=>l.updateLink(i.selectedLink))},e[75]||(e[75]=[(0,n.Lk)("option",{value:"solid"},"Solid",-1),(0,n.Lk)("option",{value:"dashed"},"Dashed",-1),(0,n.Lk)("option",{value:"dotted"},"Dotted",-1)]),544),[[a.u1,l.linkDash]])]),(0,n.Lk)("div",Rt,[e[76]||(e[76]=(0,n.Lk)("label",null,"Độ cong:",-1)),(0,n.bo)((0,n.Lk)("input",{type:"range",min:"-1",max:"1",step:"0.05","onUpdate:modelValue":e[41]||(e[41]=t=>l.linkCurvature=t),onChange:e[42]||(e[42]=t=>l.updateLink(i.selectedLink))},null,544),[[a.Jo,l.linkCurvature,void 0,{number:!0}]]),(0,n.Lk)("span",null,(0,r.v_)(l.linkCurvature),1)]),(0,n.Lk)("div",Jt,[(0,n.bo)((0,n.Lk)("select",{"onUpdate:modelValue":e[43]||(e[43]=t=>l.linkMarker=t),onChange:e[44]||(e[44]=t=>l.updateLink(i.selectedLink)),class:"style-select"},e[77]||(e[77]=[(0,n.Lk)("option",{value:"none"},"Không",-1),(0,n.Lk)("option",{value:"arrow"},"Mũi tên",-1),(0,n.Lk)("option",{value:"tree"},"Cành cây",-1),(0,n.Lk)("option",{value:"radial"},"Radial",-1)]),544),[[a.u1,l.linkMarker]])])])]),(0,n.Lk)("div",{class:"canvas",ref:"canvas",onClick:e[46]||(e[46]=(0,a.D$)(((...t)=>l.clearSelection&&l.clearSelection(...t)),["self"])),onDragover:e[47]||(e[47]=(0,a.D$)((()=>{}),["prevent"])),onDrop:e[48]||(e[48]=t=>l.drop(t)),onWheel:e[49]||(e[49]=(0,a.D$)(((...t)=>l.onWheel&&l.onWheel(...t)),["prevent"])),style:(0,r.Tr)({transform:`scale(${i.scale})`,transformOrigin:"0 0"}),tabindex:"0",onKeydown:[e[50]||(e[50]=(0,a.jR)((0,a.D$)(((...t)=>l.copyNode&&l.copyNode(...t)),["ctrl","prevent"]),["c"])),e[51]||(e[51]=(0,a.jR)((0,a.D$)(((...t)=>l.pasteNode&&l.pasteNode(...t)),["ctrl","prevent"]),["v"]))]},[((0,n.uX)(),(0,n.CE)("svg",Ht,[e[80]||(e[80]=(0,n.Lk)("defs",null,[(0,n.Lk)("marker",{id:"arrow",markerUnits:"strokeWidth",markerWidth:"6",markerHeight:"6",refX:"6",refY:"3",orient:"auto"},[(0,n.Lk)("path",{d:"M0,0 L6,3 L0,6 Z",fill:"currentColor"})])],-1)),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(i.links,((t,o)=>((0,n.uX)(),(0,n.CE)("g",{key:o,onClick:(0,a.D$)((e=>l.handleLinkClick(t)),["stop"])},["tree"===t.marker?((0,n.uX)(),(0,n.CE)("path",{key:0,onClick:(0,a.D$)((e=>l.selectLink(t)),["stop"]),d:l.computeTaperedBranch(t),fill:t.color,class:(0,r.C4)({"link--selected":t===i.selectedLink})},null,10,Gt)):"radial"===t.marker?((0,n.uX)(),(0,n.CE)("path",{key:1,onClick:(0,a.D$)((e=>l.selectLink(t)),["stop"]),id:`linkPath-${o}`,d:l.computeRadialLinkPath(t)||t.path,stroke:t.color,"stroke-width":t.thickness,fill:"none",class:(0,r.C4)({"link--selected":t===i.selectedLink})},null,10,qt)):l.getLinkPath(t.from,t.toPos||t.to,!!t.toPos,t.curvature)?((0,n.uX)(),(0,n.CE)("path",{key:2,onClick:(0,a.D$)((e=>l.selectLink(t)),["stop"]),d:l.getLinkPath(t.from,t.toPos||t.to,!!t.toPos,t.curvature),stroke:t.color,"stroke-width":t.thickness,"stroke-dasharray":l.dashArray(t.dash),"marker-end":"none"===t.marker?null:`url(#${t.marker})`,fill:"none"},null,8,Yt)):(0,n.Q3)("",!0),t===i.selectedLink&&t.toPos?((0,n.uX)(),(0,n.CE)("circle",{key:3,cx:t.toPos.x,cy:t.toPos.y,r:"6",style:{cursor:"move","pointer-events":"all"},onMousedown:(0,a.D$)((e=>l.startDragEnd(t,e)),["stop","prevent"])},null,40,Kt)):t.toPos||0!==t.curvature?t.toPos?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.CE)("path",{key:5,d:l.getLinkPath(t.from,t.to,!1,t.curvature),stroke:t.color,"stroke-width":t.thickness,"stroke-dasharray":l.dashArray(t.dash),"marker-end":"none"===t.marker?null:`url(#${t.marker})`,fill:"none",onClick:(0,a.D$)((e=>l.selectLink(t)),["stop"])},null,8,Zt)):((0,n.uX)(),(0,n.CE)("path",{key:4,x1:l.getNodeCenter(t.from).x,y1:l.getNodeCenter(t.from).y,x2:l.getNodeCenter(t.to).x,y2:l.getNodeCenter(t.to).y,stroke:t.color,"stroke-width":t.thickness,"stroke-dasharray":l.dashArray(t.dash),"marker-end":"none"===t.marker?null:`url(#${t.marker})`,fill:"none",onClick:(0,a.D$)((e=>l.selectLink(t)),["stop"])},null,8,Qt)),t===i.selectedLink?((0,n.uX)(),(0,n.CE)("circle",{key:6,cx:l.midPoint(t).x,cy:l.midPoint(t).y,r:"6",fill:"white",stroke:"gray","stroke-width":"1",style:{"pointer-events":"all",cursor:"move"},onMousedown:(0,a.D$)((e=>l.startAdjustCurvature(t,e)),["prevent"])},null,40,te)):(0,n.Q3)("",!0),"radial"===t.marker?((0,n.uX)(),(0,n.CE)("text",{key:7,"font-size":"12",fill:"#333",onDblclick:(0,a.D$)((t=>l.startEditing(o)),["stop","prevent"]),style:{"pointer-events":"all",cursor:"text"}},[(0,n.Lk)("textPath",{"xlink:href":`#linkPath-${o}`,startOffset:"65%","text-anchor":t.align,"font-weight":t.isBold?"bold":"normal","font-style":t.isItalic?"italic":"normal",fill:t.textColor,"font-family":t.fontFamily,"font-size":`${t.fontSize}px`},(0,r.v_)(t.text||"Nhập nhãn..."),9,oe)],40,ee)):(0,n.Q3)("",!0),i.editingIndex===o?((0,n.uX)(),(0,n.CE)("foreignObject",{key:8,x:i.inputX,y:i.inputY,width:"120",height:"24"},[(0,n.bo)((0,n.Lk)("input",{xmlns:"http://www.w3.org/1999/xhtml",type:"text","onUpdate:modelValue":e[45]||(e[45]=t=>i.tempText=t),onKeydown:(0,a.jR)((0,a.D$)((t=>l.finishEditing(o)),["prevent"]),["enter"]),onBlur:t=>l.finishEditing(o),ref_for:!0,ref:"editableInput",style:{"font-size":"12px",padding:"4px",border:"1px solid #2196f3",background:"#fff","border-radius":"4px",width:"100%",height:"100%","box-sizing":"border-box"}},null,40,ne),[[a.Jo,i.tempText]])],8,ae)):(0,n.Q3)("",!0)],8,Vt)))),128)),i.linking.active&&i.linking.fromNode?((0,n.uX)(),(0,n.CE)("line",{key:0,x1:l.getNodeCenter(i.linking.fromNode.id).x,y1:l.getNodeCenter(i.linking.fromNode.id).y,x2:i.linking.tempPos.x,y2:i.linking.tempPos.y,stroke:"#999","stroke-dasharray":"4,4"},null,8,se)):(0,n.Q3)("",!0)],512)),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(i.nodes,(t=>((0,n.uX)(),(0,n.CE)("div",{key:t.id,"data-id":t.id,class:(0,r.C4)([{"node--disabled":i.linkMode},"node"]),style:(0,r.Tr)({top:t.top+"px",left:t.left+"px",width:t.width+"px",height:t.height+"px",overflow:"visible",transform:`rotate(${t.rotation}deg)`,transformOrigin:"center center"}),onMousedown:e=>l.startDragNode(t,e),onClick:(0,a.D$)((e=>l.handleNodeClick(t)),["stop"])},[i.selectedNode&&i.selectedNode.id===t.id?((0,n.uX)(),(0,n.CE)("div",{key:0,class:"rotate-handle",onMousedown:(0,a.D$)((e=>l.startRotate(t,e)),["stop","prevent"])},e[81]||(e[81]=[(0,n.Lk)("i",{class:"fa-solid fa-arrows-spin"},null,-1)]),40,re)):(0,n.Q3)("",!0),i.selectedNode&&i.selectedNode.id===t.id?((0,n.uX)(),(0,n.CE)("div",{key:1,class:"link-handle",onMousedown:(0,a.D$)((e=>l.beginLink(t,e)),["stop","prevent"])},"+",40,le)):(0,n.Q3)("",!0),(0,n.Lk)("div",{class:(0,r.C4)(["shape-inner",t.type]),style:(0,r.Tr)(l.shapeInnerStyle(t)),contenteditable:!i.linking.active,onBlur:e=>l.updateNodeText(e,t)},["image"===t.type?((0,n.uX)(),(0,n.CE)("img",{key:0,src:t.image,alt:"node image",style:{width:"100%",height:"100%","object-fit":"contain"}},null,8,ce)):((0,n.uX)(),(0,n.CE)("span",{key:1,innerHTML:t.text||t.type},null,8,he))],46,de),i.selectedNode&&i.selectedNode.id===t.id?((0,n.uX)(),(0,n.CE)(n.FK,{key:2},[(0,n.Lk)("div",{class:"resize-handle top-left",onMousedown:(0,a.D$)((e=>l.startResize(t,e,"top-left")),["stop"])},null,40,ue),(0,n.Lk)("div",{class:"resize-handle top-center",onMousedown:(0,a.D$)((e=>l.startResize(t,e,"top-center")),["stop"])},null,40,pe),(0,n.Lk)("div",{class:"resize-handle top-right",onMousedown:(0,a.D$)((e=>l.startResize(t,e,"top-right")),["stop"])},null,40,me),(0,n.Lk)("div",{class:"resize-handle mid-left",onMousedown:(0,a.D$)((e=>l.startResize(t,e,"mid-left")),["stop"])},null,40,ge),(0,n.Lk)("div",{class:"resize-handle mid-right",onMousedown:(0,a.D$)((e=>l.startResize(t,e,"mid-right")),["stop"])},null,40,fe),(0,n.Lk)("div",{class:"resize-handle bottom-left",onMousedown:(0,a.D$)((e=>l.startResize(t,e,"bottom-left")),["stop"])},null,40,ke),(0,n.Lk)("div",{class:"resize-handle bottom-center",onMousedown:(0,a.D$)((e=>l.startResize(t,e,"bottom-center")),["stop"])},null,40,ye),(0,n.Lk)("div",{class:"resize-handle bottom-right",onMousedown:(0,a.D$)((e=>l.startResize(t,e,"bottom-right")),["stop"])},null,40,be)],64)):(0,n.Q3)("",!0)],46,ie)))),128))],36)])])}o(116),o(7588),o(1701),o(7642),o(8004),o(3853),o(5876),o(2475),o(5024),o(1698);var Le=o(9121),ve=o(5555);let we=1;var Ce={name:"CreateMindMap",props:{id:{type:String,default:null}},data(){return{scale:1,minScale:.2,maxScale:3,scaleStep:.1,translate:{x:0,y:0},history:[],nodes:[],links:[],rawData:[],historyIndex:-1,linking:{active:!1,fromNode:null,tempPos:{x:0,y:0}},linkMode:!1,currentDrag:null,selectedNode:null,draggingNode:null,selectedLink:null,offsetX:0,offsetY:0,resizingNode:null,resizeDir:null,startX:0,startY:0,startW:0,startH:0,startL:0,startT:0,customColor:!1,customColor1:!1,selectedFont:"",selectedColor:"#000000",selectedFontSize:12,selectedAlign:"center",defaultNodeBorderColor:"#333333",defaultNodeBackgroundColor:"#ffffff",defaultNodeBorderThickness:2,defaultNodeBorderStyle:"solid",dragStartSave:{x:0,y:0},defaultLinkColor:"#000000",defaultLinkThickness:2,defaultLinkDash:"solid",defaultLinkCurvature:0,defaultLinkMarker:"none",draggingLinkEnd:null,mindmapData:null,selectedTemplate:null,loading:!1,error:null,selectedMapType:"free",mindmapObject:null,showModal:!1,form:{mapTitle:""},rotatingNode:null,rotateStartAngle:0,rotateCenter:{x:0,y:0},svg:null,inputX:0,inputY:0,editingIndex:null,tempText:""}},async mounted(){this.svg=Le.Ltv(this.$refs.canvas);const{id:t}=this.$route.params;if(t){this.loading=!0;try{const e=await fetch(`/api/listMindmap/${t}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),o=await e.json(),a=o.item??o.data??o.payload??o;this.form.mapTitle=a.title;const n=a.mapType??a.type;let s="manual"===n||"free"===n?a.manualData:a.mindmapData;"string"===typeof s&&(s=JSON.parse(s)),this.nodes=(s.nodes||[]).map((t=>({...t,left:t.x,top:t.y}))),this.links=s.links||[],"manual"===n&&this.nodes.forEach((t=>{t.text=String(t.text).replace(/<[^>]+>/g,"")})),this.selectedMapType=n,this.mindmapObject=s,this.$nextTick((()=>{this.drawMindMap(this.svg),this.initSelection&&this.initSelection()}))}catch(e){console.error(e),this.error=e.message}finally{this.loading=!1}}},computed:{nodeBorderColor:{get(){return this.selectedNode?.borderColor??this.defaultNodeBorderColor},set(t){this.selectedNode?this.selectedNode.borderColor=t:this.defaultNodeBorderColor=t}},nodeBackgroundColor:{get(){return this.selectedNode?.backgroundColor??this.defaultNodeBackgroundColor},set(t){this.selectedNode?this.selectedNode.backgroundColor=t:this.defaultNodeBackgroundColor=t}},nodeBorderThickness:{get(){return this.selectedNode?.borderThickness??this.defaultNodeBorderThickness},set(t){this.selectedNode?this.selectedNode.borderThickness=t:this.defaultNodeBorderThickness=t}},nodeBorderStyle:{get(){return this.selectedNode?.borderStyle??this.defaultNodeBorderStyle},set(t){this.selectedNode?this.selectedNode.borderStyle=t:this.defaultNodeBorderStyle=t}},straightLinks(){return this.links.filter((t=>0===(t.curvature||0)&&void 0!==t.to))},curvedLinks(){return this.links.filter((t=>(t.curvature||0)>0&&void 0!==t.to))},posLinks(){return this.links.filter((t=>void 0!==t.toPos))},linkColor:{get(){return this.selectedLink?.color??this.defaultLinkColor},set(t){this.selectedLink?this.selectedLink.color=t:this.defaultLinkColor=t}},linkThickness:{get(){return this.selectedLink?.thickness??this.defaultLinkThickness},set(t){this.selectedLink?this.selectedLink.thickness=t:this.defaultLinkThickness=t}},linkDash:{get(){return this.selectedLink?.dash??this.defaultLinkDash},set(t){this.selectedLink?this.selectedLink.dash=t:this.defaultLinkDash=t}},linkCurvature:{get(){return this.selectedLink?.curvature??this.defaultLinkCurvature},set(t){this.selectedLink?this.selectedLink.curvature=t:this.defaultLinkCurvature=t}},linkMarker:{get(){return this.selectedLink?.marker??this.defaultLinkMarker},set(t){this.selectedLink?this.selectedLink.marker=t:this.defaultLinkMarker=t}},canSave(){return!(!this.selectedImageUrl&&!this.mindmapObject)},isEditing(){return!!this.$route.params.id}},methods:{copyNode(){this.selectedNode&&(this.clipboardNode=JSON.parse(JSON.stringify(this.selectedNode)),delete this.clipboardNode.id,console.log("Copied",this.clipboardNode))},pasteNode(){if(!this.clipboardNode)return;const t=JSON.parse(JSON.stringify(this.clipboardNode));t.id=Date.now(),t.left+=20,t.top+=20,this.nodes.push(t),this.selectedNode=t,console.log("Pasted",t)},startEditing(t){console.log("👉 startEditing với index =",t),this.$nextTick((()=>{const e=document.getElementById(`linkPath-${t}`);if(!e)return void console.warn("Không tìm thấy path với id linkPath-"+t);const o=e.getTotalLength(),a=e.getPointAtLength(.5*o);this.inputX=a.x-60,this.inputY=a.y-12,this.editingIndex=t,this.tempText=this.links[t].text||"",this.$nextTick((()=>{const t=this.$refs.editableInput,e=Array.isArray(t)?t[0]:t;if(e){e.focus();const t=e.value.length;e.setSelectionRange(t,t)}}))}))},finishEditing(t){console.log("✍️ finishEditing với index =",t,"giá trị mới:",this.tempText),this.links[t].text=this.tempText.trim(),this.editingIndex=null,this.tempText=""},startRotate(t,e){this.selectedNode=t,this.rotatingNode=t;const o=e.currentTarget.parentNode,a=o.getBoundingClientRect(),n=a.left+a.width/2,s=a.top+a.height/2;this.rotateCenter={x:n,y:s};const i=e.clientX,r=e.clientY,l=180*Math.atan2(r-s,i-n)/Math.PI;console.log("startRotate:",{cx:n,cy:s,mx:i,my:r,nodeRotation:t.rotation,startAngle:l}),this.rotateStartAngle=l-t.rotation,console.log("rotateStartAngle:",this.rotateStartAngle),window.addEventListener("mousemove",this.onRotate),window.addEventListener("mouseup",this.stopRotate)},onRotate(t){if(!this.rotatingNode)return;const{x:e,y:o}=this.rotateCenter,a=t.clientX,n=t.clientY;let s=180*Math.atan2(n-o,a-e)/Math.PI;console.log("onRotate:",{cx:e,cy:o,mx:a,my:n,rawAngle:s}),s-=this.rotateStartAngle,console.log("computed rotation:",s),this.rotatingNode.rotation=s},stopRotate(){window.removeEventListener("mousemove",this.onRotate),window.removeEventListener("mouseup",this.stopRotate),this.rotatingNode=null},openModal(){this.showModal=!0},closeModal(){this.showModal=!1},async exportPPT(){try{const t=new window.PptxGenJS,e={};this.nodes.forEach((t=>{const o=document.querySelector(`.node[data-id="${t.id}"] .shape-inner`),a=o?o.innerText.trim():(t.text||"").trim();e[t.id]={id:t.id,text:a,children:[]}})),this.links.forEach((t=>{const o=t.from,a=t.to??t.attachedTo;e[o]&&e[a]&&e[o].children.push(e[a])}));const o=new Set(this.links.map((t=>t.to??t.attachedTo))),a=Object.values(e).find((t=>!o.has(t.id)));if(!a)return alert("Không tìm thấy root!");const n=[],s=t=>{n.push(t),t.children.forEach(s)};s(a),n.forEach((e=>{const o=t.addSlide();if(o.addText(e.text,{x:.5,y:.5,fontSize:28,bold:!0}),e.children.length){let t=1.2;e.children.forEach(((e,a)=>{o.addText(e.text,{x:.7,y:t+.5*a,fontSize:18,bullet:!0,margin:.05})}))}})),console.log("Số slide tạo được:",t.slides.length),await t.writeFile({fileName:"MindMap_AllSlides.pptx"}),alert("Đã xuất "+t.slides.length+" slide!")}catch(t){console.error(t),alert("Lỗi khi xuất PPT: "+t.message)}},_exportSvgMarkup(){const t=this.$refs.canva;if(!t)throw new Error("SVG not found");const e=t.cloneNode(!0);e.setAttribute("xmlns","http://www.w3.org/2000/svg"),e.setAttribute("width",t.clientWidth),e.setAttribute("height",t.clientHeight);const o=document.createElementNS("http://www.w3.org/2000/svg","rect");return o.setAttribute("x",0),o.setAttribute("y",0),o.setAttribute("width",t.clientWidth),o.setAttribute("height",t.clientHeight),o.setAttribute("fill","#fff"),e.insertBefore(o,e.firstChild),(new XMLSerializer).serializeToString(e)},async _generateImageFromSvg(t=900){const e=this.$refs.canvas;if(!e)throw new Error("SVG element not found");this.inlineAllStyles(e);const o=e.clientWidth,a=e.clientHeight,n=t/o,s=t,i=Math.round(a*n);try{const t=await ve.gO(e,{backgroundColor:"white",width:s,height:i,quality:.7});return t}catch(r){throw console.error("Lỗi khi tạo JPEG:",r),r}},async _postSaveManual(){const t=this.form.mapTitle.trim();if(!t)return alert("Nhập tên sơ đồ tư duy");const e=this.$route.params.id;console.log("id",e);const o=Boolean(e),a=o?`/api/listMindmap/${e}`:"/api/listMindmap",n=o?"PUT":"POST";this.loading=!0;try{const e=localStorage.getItem("token");if(!e)throw new Error("Chưa có token");const s=this._exportSvgMarkup(),i=await this._generateImageFromSvg(900),r=this.nodes.map((t=>({id:t.id,type:t.type,x:t.left,y:t.top,width:t.width,height:t.height,text:t.text,fontFamily:t.fontFamily,fontSize:t.fontSize,isBold:t.isBold,isItalic:t.isItalic,textColor:t.textColor,align:t.align,borderColor:t.borderColor,borderWidth:t.borderWidth,borderStyle:t.borderStyle,backgroundColor:t.backgroundColor,imageUrl:t.imageUrl,rotation:t.rotation}))),l=this.links.map((t=>null!=t.attachedTo?{id:t.id||`${t.from}-${t.attachedTo}`,from:t.from,to:t.attachedTo||t.to,toPos:null,color:t.color,thickness:t.thickness,dash:t.dash,curvature:t.curvature,marker:t.marker,custom:t.custom,path:t.path||this.computeLinkPath(t),text:t.text,fontFamily:t.fontFamily,fontSize:t.fontSize,isBold:t.isBold,isItalic:t.isItalic,textColor:t.textColor,align:t.align}:{id:t.id||`${t.from}-free`,from:t.from,to:null,toPos:t.toPos?{x:t.toPos.x,y:t.toPos.y}:void 0,color:t.color,thickness:t.thickness,dash:t.dash,curvature:t.curvature,marker:t.marker,custom:t.custom,path:t.path||this.computeLinkPath(t),text:t.text,fontFamily:t.fontFamily,fontSize:t.fontSize,isBold:t.isBold,isItalic:t.isItalic,textColor:t.textColor,align:t.align})),d={title:t,type:"manual",mapType:"free",svgMarkup:s,imageUrl:i,manualData:{nodes:r,links:l}};console.log("PAYLOAD:",d);const c=await fetch(a,{method:n,headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(d)}),h=await c.json();if(!c.ok)throw new Error(h.message||"Lưu thất bại");alert(o?"Cập nhật thành công!":"Lưu thành công!"),o&&h.manualData&&(this.nodes=h.manualData.nodes.map((t=>({...t,left:t.x,top:t.y}))),this.links=h.manualData.links),this.closeModal()}catch(s){console.error(s),alert("Lỗi khi lưu: "+s.message)}finally{this.loading=!1}},drawMindMap(){const t=Le.Ltv(this.$refs.canva);if(t.selectAll("path.link").remove(),t.selectAll("g.node").remove(),"manual"===this.selectedMapType)this.drawFreeMap(t,this.mindmapObject);else{const e={bubble:this.drawBubbleMap,tree:this.drawTreeMap,flow:this.drawFlowMap,multiFlow:this.drawMultiFlowMap,brace:this.drawBraceMap}[this.selectedMapType];e.call(this,t,this.mindmapObject)}},findNode(t,e){return e.find((e=>e.id===t))||{x:0,y:0}},drawTreeMap(t,e){if(!e)return;let o;o=void 0!==e.root&&Array.isArray(e.branches)?{id:"root",name:"string"===typeof e.root?e.root:"",children:e.branches.map((t=>({id:`b:${t.title}`,name:"string"===typeof t.title?t.title:"",children:Array.isArray(t.subBranches)?t.subBranches.map((e=>({id:`b:${t.title}|s:${e}`,name:"string"===typeof e?e:"",children:[]}))):[]})))}:e;const a=t.node().clientWidth,n=t.node().clientHeight,s=a/2,i=n/4,r=Math.min(a,n)/2-80,l=12,d=Le.Sk5(o,(t=>t.children||[]));Le.bzR().size([2*Math.PI,r])(d);const c=80;d.descendants().sort(((t,e)=>t.depth-e.depth)).forEach((t=>{if(0===t.depth)t.yOffset=0;else{const e="number"===typeof t.parent.yOffset?t.parent.yOffset:0;let o=e+this.textWidth(t.data.name||"")+l;o+=c,t.yOffset=o}}));const h=[];d.descendants().forEach((t=>{if(0!==t.depth)return;const e=t.data.name||"",o=e.split(/\s+/),a=[];for(let s=0;s<o.length;s+=3)a.push(o.slice(s,s+3).join(" "));const n=16,r=a.length?Math.max(...a.map((t=>this.textWidth(t,`${n}px Arial`)))):0,d=50,c=Math.max(d,r/2+l),u=("number"===typeof t.x?t.x:0)-Math.PI/2,p="number"===typeof t.yOffset?t.yOffset:0,m=s+p*Math.cos(u),g=i+p*Math.sin(u),f=t.data,k=f.backgroundColor||"#ffffff",y=f.borderColor||"#333333",b=null!=f.borderWidth?f.borderWidth:2,x=f.borderStyle||"solid",L=f.textColor||"#000000",v=f.fontFamily||"Arial",w=!0,C=!!f.isItalic,M=f.imageUrl||null;h.push({id:f.id,type:"circle",top:isNaN(g-c+30)?i-c+30:g-c+30,left:isNaN(m-c+5)?s-c+5:m-c+5,width:isNaN(1.5*c)?0:1.5*c,height:isNaN(c)?0:c,rotation:0,text:e,fontFamily:v,fontSize:n,isBold:w,isItalic:C,textColor:L,align:"center",borderColor:y,backgroundColor:k,borderWidth:b,borderStyle:x,imageUrl:M})})),this.nodes=h;const u=Le.e7Y().angle((t=>"number"===typeof t.x?t.x:0)).radius((t=>"number"===typeof t.yOffset?t.yOffset:0)),p=d.links().map(((t,e)=>{let o="";try{o=u(t)||""}catch{o=""}let a="";o&&(a=o.replace(/(-?\d+(\.\d+)?),(-?\d+(\.\d+)?)/g,((t,e,o,a)=>{const n=parseFloat(e),r=parseFloat(a);return isNaN(n)||isNaN(r)?`${s},${i}`:`${n+s},${r+i}`})));const n=0===t.source.depth&&1===t.target.depth,r=n||0===t.source.depth?8:2;return{id:`link-${e}`,from:t.source.data.id,to:t.target.data.id,color:"aqua",thickness:r,dash:this.linkDash||[],marker:"radial",path:a,text:t.target.data.name||"",fontSize:n?14:12,textColor:"#333",fontFamily:"Arial",isBold:n,isItalic:!1,align:"middle"}}));this.links=p,this.selectedNode=null,this.selectedLink=null,t.selectAll("*").remove()},wrapText(t,e,o=1.2){t.each((function(){const t=Le.Ltv(this),a=t.text().split(/\s+/);t.text(null);let n=[];const s=t.attr("x"),i=t.attr("y"),r=parseFloat(t.attr("dy"))||0;let l=t.append("tspan").attr("x",s).attr("y",i).attr("dy",`${r}em`);for(let d=0;d<a.length;d++)n.push(a[d]),l.text(n.join(" ")),l.node().getComputedTextLength()>e&&n.length>1&&(n.pop(),l.text(n.join(" ")),n=[a[d]],l=t.append("tspan").attr("x",s).attr("y",i).attr("dy",`${o}em`).text(a[d]))}))},chunkText(t,e=3){const o=t.split(/\s+/),a=[];for(let n=0;n<o.length;n+=e)a.push(o.slice(n,n+e).join(" "));return a},drawBubbleMap(t,e){if(!e||!e.root)return void console.error("Invalid treeData!",e);const o=this,a={id:"root",name:e.root,children:e.branches.map((t=>({id:`b:${t.title}`,name:t.title,children:t.subBranches.map((e=>({id:`b:${t.title}|s:${e}`,name:e})))})))},n=Le.Sk5(a,(t=>t.children||[])),s=t.node().clientWidth,i=t.node().clientHeight,r=s/2,l=i/4,d=8,c=120,h=60,u=60;function p(t,e,a,s,i){const r=t.data.name.split(/\s+/),l=[];for(let o=0;o<r.length;o+=3)l.push(r.slice(o,o+3).join(" "));const m=0===s?14:1===s?12:10,g=`${m}px sans-serif`,f=Math.max(...l.map((t=>o.textWidth(t,g)))),k=Math.max(0===s?80:40,f/2+d);t.data.x=e,t.data.y=a,t.data.rDyn=k,t.data.fontSize=m,t.data.fill||=0===s?"aqua":"#fff",t.data.stroke||=0===s?"#333":"#007bff",t.data.strokeWidth||=0===s?2:1.5,t.data.textColor||="#000",t.data.fontFamily||="sans-serif",t.data.isBold=!!t.data.isBold,t.data.isItalic=!!t.data.isItalic,t.data.borderColor||=t.data.stroke,t.data.borderWidth||=t.data.strokeWidth,t.data.borderStyle||="solid",t.data.backgroundColor||=t.data.fill;const y=t.children||[];if(!y.length)return;const b=n.children.length,x=2*Math.PI/b;if(0===s)y.forEach(((t,o)=>{const n=-Math.PI/2+x/2+o*x,s=c;p(t,e+Math.cos(n)*(k+s),a+Math.sin(n)*(k+s),1,n)}));else{const t=i-x/2;y.forEach(((o,n)=>{const i=t+x*(n/(y.length-1||1));let r=h+20*(y.length-1);o.children?.length||(r+=u),p(o,e+Math.cos(i)*(k+r),a+Math.sin(i)*(k+r),s+1,i)}))}}p(n,r,l,0,0);const m=n.descendants().map((t=>({id:t.data.id,type:t.data.type||"circle",text:t.data.name,left:t.data.x-t.data.rDyn,top:t.data.y-t.data.rDyn,width:2*t.data.rDyn,height:2*t.data.rDyn,rotation:0,backgroundColor:t.data.backgroundColor,borderColor:t.data.borderColor,borderWidth:t.data.borderWidth,borderStyle:t.data.borderStyle,textColor:t.data.textColor,fontSize:t.data.fontSize,fontFamily:t.data.fontFamily,isBold:t.data.isBold,isItalic:t.data.isItalic}))),g=[];n.descendants().forEach((t=>{t.parent&&g.push({from:t.parent.data.id,to:t.data.id,marker:"none",color:"#333",thickness:1.5,curvature:0,dash:"solid"})})),o.nodes=m,o.links=g},drawFreeMap(t){console.count("drawFreeMap called");const e=this,o=e.mindmapObject||{nodes:[],links:[]};e.nodes=(o.nodes||[]).map((t=>({id:String(t.id),type:t.type||"rectangle",left:Number(t.x)||0,top:Number(t.y)||0,width:Number(t.width)||120,height:Number(t.height)||80,rotation:Number(t.rotation)||0,text:String(t.text||"").replace(/<[^>]+>/g,""),fontFamily:t.fontFamily||"Arial",fontSize:Number(t.fontSize)||14,isBold:!!t.isBold,isItalic:!!t.isItalic,textColor:t.textColor||"#000000",align:t.align||"center",borderColor:t.borderColor||"#000000",backgroundColor:t.backgroundColor||"#ffffff",borderWidth:Number(t.borderWidth)||1,borderStyle:t.borderStyle||"solid",imageUrl:t.imageUrl||null,custom:t.custom||null}))),console.log("this.nodes = ",this.nodes.map((t=>t.id)));const a=(o.links||[]).map((t=>{const e=String(t.from),o=null!=t.to&&""!==String(t.to)?String(t.to):null;if(o)return{id:String(t.id||`${e}-${o}-${Date.now()}`),from:e,to:o,toPos:null,attachedTo:o||null,color:t.color||"#000000",thickness:Number(t.thickness)||2,dash:t.dash||"solid",curvature:Number(t.curvature)||0,marker:t.marker||"none",custom:t.custom||null,path:t.path||"",text:t.text||"",fontFamily:t.fontFamily||"Arial",fontSize:Number(t.fontSize)||14,isBold:!!t.isBold,isItalic:!!t.isItalic,textColor:t.textColor||"#000",align:t.align||"middle"};{const o=t.toPos&&null!=Number(t.toPos.x)?Number(t.toPos.x):0,a=t.toPos&&null!=Number(t.toPos.y)?Number(t.toPos.y):0;return{id:String(t.id||`${e}-free-${Math.round(o)}_${Math.round(a)}`),from:e,to:null,toPos:{x:o,y:a},attachedTo:null,color:t.color||"#000000",thickness:Number(t.thickness)||2,dash:t.dash||"solid",curvature:Number(t.curvature)||0,marker:t.marker||"none",custom:t.custom||null,path:t.path||"",text:t.text||"",fontFamily:t.fontFamily||"Arial",fontSize:Number(t.fontSize)||14,isBold:!!t.isBold,isItalic:!!t.isItalic,textColor:t.textColor||"#000",align:t.align||"middle"}}}));e.links=a,console.log(e.links),e.$nextTick((()=>{t.selectAll("g.link-group").remove(),t.selectAll("path.link").remove(),t.selectAll("circle.link-handle").remove()}))},computeLinkPath(t){const e=Object.fromEntries(this.nodes.map((t=>[t.id,t]))),o=e[t.from],a=null!=t.to&&e[t.to]?e[t.to]:{left:t.toPos?.x,top:t.toPos?.y,width:0,height:0};if(!o||!a||isNaN(o.left)||isNaN(o.top)||isNaN(a.left)||isNaN(a.top))return console.warn("computeLinkPath: missing data for",t,o,a),"";const n=o.left+o.width/2,s=o.top+o.height/2,i=a.left+a.width/2,r=a.top+a.height/2,l=i-n,d=r-s,c=n+l/2-d*(t.curvature||0),h=s+d/2+l*(t.curvature||0);return`M${n},${s} Q${c},${h} ${i},${r}`},_findNode(t,e){const o=e.find((e=>e.id===t));return o||(console.error(`_findNode: cannot find node with id="${t}"`,e),{x:0,y:0})},buildHierarchy(t){const e={name:t.root,fill:t.fill,stroke:t.stroke,children:(t.branches||[]).map((t=>({name:t.title,fill:t.fill,stroke:t.stroke,children:(t.subBranches||[]).map((t=>({name:t.name||t,fill:t.fill,stroke:t.stroke})))})))},o=Le.Sk5(e,(t=>t.children));let a=0;return o.each((t=>{t.data.id=a++,t.data.backgroundColor=null!=t.data.fill?t.data.fill:this.defaultNodeBackgroundColor,t.data.borderColor=null!=t.data.stroke?t.data.stroke:this.defaultNodeBorderColor,t.data.borderWidth=this.defaultNodeBorderThickness,t.data.borderStyle=this.defaultNodeBorderStyle,t.data.textColor=t.data.textColor??"#333",t.data.borderWidth=t.data.borderWidth??(0===t.depth?2:1.5)})),o},textWidth(t){const e=document.createElement("canvas").getContext("2d");return e.font="12px sans-serif",e.measureText(t).width},drawFlowMap(t,e){const o=this,a=t.node();if(!a)return void console.error("SVG chưa sẵn sàng!");const n=a.clientWidth,s=a.clientHeight,i=n/4,r=s/2;console.log("treeData:",e);const l={id:"root",name:e.root||"",children:(e.branches||[]).map((t=>({id:`b:${t.title}`,name:t.title,children:(t.subBranches||[]).map((e=>({id:`b:${t.title}|s:${e}`,name:e})))})))};console.log("rootObj:",l);const d=Le.Sk5(l,(t=>t.children||[]));Le.B22().nodeSize([70,300]).separation(((t,e)=>t.parent===e.parent?1:2))(d);const c=Number(d.x)||0,h=Number(d.y)||0,u=i-h,p=r-c;console.log({rootX:c,rootY:h,offsetX:u,offsetY:p});const m=Le.pqs().x((t=>(Number(t.y)||0)+u)).y((t=>(Number(t.x)||0)+p)),g=o._canvasCtx||(o._canvasCtx=document.createElement("canvas").getContext("2d"));function f(t,e,o=!1){return g.font=(o?"bold ":"")+e+"px Arial",g.measureText(t).width}o.nodes=d.descendants().map((t=>{const e=t.depth,o=0===e,a=t.data.name,n=Math.max(14-2*e,10),s=f(a,n,o),i=o?s+40:s+20,r=o?s+40:1.5*n,l=Number(t.y),d=Number(t.x),c=(isNaN(l)?0:l)+u,h=(isNaN(d)?0:d)+p;return{id:t.data.id,type:o?"circle":"rectangle",x:c,y:h,left:c,top:h,width:1.5*i,height:1.5*r,rotation:0,text:a,fontFamily:"Arial",fontSize:o?20:14,isBold:o,isItalic:!1,textColor:"#000000",align:"center",borderColor:"#000",backgroundColor:"aqua",borderWidth:1,borderStyle:"solid",imageUrl:null}})),console.log("nodes:",o.nodes),o.links=d.links().map(((t,e)=>({id:`l${e}`,from:t.source.data.id,to:t.target.data.id,toPos:null,color:"#0bf",thickness:2,dash:"solid",curvature:.01*(t.source.depth-t.target.depth),marker:"arrow",custom:null,path:m(t),text:"",fontFamily:"Arial",fontSize:12,isBold:!1,isItalic:!1,textColor:"#000000",align:"middle"}))),console.log("links:",o.links)},drawMultiFlowMap(t,e){const o=this,a=t.node();if(!a)return;const n=a.clientWidth,s=a.clientHeight,i=n/1.8,r=s/4,l={id:"root",name:e.root||"",children:(e.branches||[]).map((t=>({id:`b:${t.title}`,name:t.title,children:(t.subBranches||[]).map((e=>({id:`b:${t.title}|s:${e}`,name:e})))})))},d=Le.Sk5(l,(t=>t.children));Le.B22().nodeSize([80,100]).separation(((t,e)=>t.parent===e.parent?1:2))(d);const c=i-d.y,h=r-d.x,u=o._txtCtx||=document.createElement("canvas").getContext("2d");function p(t,e,o=!1){return u.font=`${o?"bold ":""}${e}px Arial`,u.measureText(t).width}const m=Le.pqs().x((t=>t.y+c)).y((t=>t.x+h));o.nodes=[],o.links=[];const g=20,f=Math.min(200,p(l.name,g,!0)),k=f/2+20;o.nodes.push({id:l.id,type:"circle",x:c,y:h,left:c,top:h,width:2*k,height:2*k,text:l.name,fontFamily:"Arial",fontSize:g,isBold:!0,isItalic:!1,textColor:"#000",align:"center",borderColor:"#000",backgroundColor:"aqua",borderWidth:1,borderStyle:"solid",imageUrl:null});const y=l.children,b=Math.ceil(y.length/2),x=y.slice(0,b),L=y.slice(b),v=t=>Le.Sk5({id:l.id,name:l.name,children:t},(t=>t.children)),w=v(x),C=v(L);Le.B22().nodeSize([80,300]).separation(((t,e)=>t.parent===e.parent?1:2))(w),Le.B22().nodeSize([80,330]).separation(((t,e)=>t.parent===e.parent?1:2))(C);const M=t=>t.descendants().map((t=>t.x)),N=t=>(Math.min(...t)+Math.max(...t))/2,S=N(M(w)),I=N(M(C));function T(t,e,a){t.links().forEach(((t,n)=>{const s=t.source.x-e,i=t.source.y+(0===t.source.depth?a?-k:k:0),r=t.target.x-e,l=t.target.y;o.links.push({id:`link_${a?"L":"R"}_${n}`,from:t.source.data.id,to:t.target.data.id,toPos:null,color:"aqua",thickness:2,dash:"solid",curvature:0,marker:"arrow",custom:null,path:m({source:{x:s,y:i},target:{x:r,y:l}}),text:"",fontFamily:"Arial",fontSize:14,isBold:!1,isItalic:!1,textColor:"#000",align:"middle"})})),t.descendants().slice(1).forEach((t=>{let n=t.x-e,s=t.y+(1===t.depth?a?-100:100:0);a&&(s=-s);const i=t.data.name,r=Math.max(12-2*t.depth,10),l=p(i,r),d=l+20,u=1.2*r+8,m=s+c,g=n+h+50;o.nodes.push({id:t.data.id,type:"rectangle",x:m,y:g,left:m,top:g,width:1.5*d,height:1.5*u,text:i,fontFamily:"Arial",fontSize:r,isBold:!1,isItalic:!1,textColor:"#000",align:"center",borderColor:"#000",backgroundColor:"aqua",borderWidth:1,borderStyle:"solid",imageUrl:null})}))}T(w,S,!0),T(C,I,!1)},drawBraceMap(t,e){const o=this,a=t.node();if(!a)return;const n=a.clientWidth,s=a.clientHeight,i=n/.45,r=100;console.log(s);const l={id:"root",name:e.root||"",children:(e.branches||[]).map((t=>({id:`b:${t.title}`,name:t.title,children:(t.subBranches||[]).map((e=>({id:`b:${t.title}|s:${e}`,name:e})))})))},d=Le.Sk5(l,(t=>t.children)),c=100,h=150,u=800,p=180;d.x=i,d.y=r,(d.children||[]).forEach(((t,e,o)=>{t.x=i+(e-(o.length-1)/2)*u,t.y=r+c})),d.children?.forEach((t=>{(t.children||[]).forEach(((e,o,a)=>{e.x=t.x+(o-(a.length-1)/2)*p,e.y=r+c+h}))})),o.links=d.links().map(((t,e)=>{const o=t.source.x,a=t.source.y,n=t.target.x,s=t.target.y;return{id:`link${e}`,from:t.source.data.id,to:t.target.data.id,toPos:null,color:"#555",thickness:2,dash:"solid",curvature:0,marker:"arrow",custom:null,path:`M${o},${a}L${n},${s}`,text:"",fontFamily:"Arial",fontSize:12,isBold:!1,isItalic:!1,textColor:"#000",align:"middle"}}));const m=o._txtCtx||=document.createElement("canvas").getContext("2d");function g(t,e,o=!1){return m.font=`${o?"bold ":""}${e}px Arial`,m.measureText(t).width}o.nodes=d.descendants().map((t=>{const e=t.x,o=t.y;let a,n,s;0===t.depth?(a=18,n=15,s=3):1===t.depth?(a=14,n=10,s=2):(a=12,n=8,s=1);const i=t.data.name,r=Math.min(200,g(i,a,0===t.depth)),l=r+2*n,d=1.2*a+2*n;return{id:t.data.id,type:"rectangle",x:e,y:o,left:e-l/2,top:o-d/2,width:l,height:d,rotation:0,text:i,fontFamily:"Arial",fontSize:a,isBold:0===t.depth,isItalic:!1,textColor:"#000",align:"center",borderColor:"purple",backgroundColor:"#fff",borderWidth:s,borderStyle:"solid",imageUrl:null}}))},selectTemplate(t){const e=this.templates.find((e=>e.key===t));e&&(this.selectedTemplate=e,this.nodes=JSON.parse(JSON.stringify(e.nodes)),this.links=JSON.parse(JSON.stringify(e.links)))},zoomIn(){this.scale=Math.min(this.scale+this.scaleStep,this.maxScale),this.pushHistory()},zoomOut(){this.scale=Math.max(this.scale-this.scaleStep,this.minScale),this.pushHistory()},onWheel(t){t.deltaY>0?this.zoomOut():this.zoomIn(),this.pushHistory()},pushHistory(){const t=Array.isArray(this.nodes)?this.nodes:[],e=Array.isArray(this.links)?this.links:[];this.history.splice(this.historyIndex+1);const o={nodes:JSON.parse(JSON.stringify(t)),links:JSON.parse(JSON.stringify(e)),scale:this.scale};this.history.push(o),this.historyIndex=this.history.length-1},undo(){this.historyIndex>0&&(this.historyIndex--,this.restore(this.history[this.historyIndex]))},redo(){this.historyIndex<this.history.length-1&&(this.historyIndex++,this.restore(this.history[this.historyIndex]))},restore(t){this.nodes=JSON.parse(JSON.stringify(t.nodes)),this.links=JSON.parse(JSON.stringify(t.links)),void 0!==t.scale&&(this.scale=t.scale)},addNode(t){this.nodes.push(t),this.pushHistory()},mounted(){this.pushHistory()},startDragEnd(t){this.draggingLinkEnd=t,window.addEventListener("mousemove",this.trackDragEnd),window.addEventListener("mouseup",this.stopDragEnd)},trackDragEnd(t){if(!this.draggingLinkEnd)return;const e=this.$refs.canvas.getBoundingClientRect();this.draggingLinkEnd.toPos={x:t.clientX-e.left,y:t.clientY-e.top},this.draggingLinkEnd.attachedTo=null},stopDragEnd(){window.removeEventListener("mousemove",this.trackDragEnd),window.removeEventListener("mouseup",this.stopDragEnd),this.draggingLinkEnd=null},getLinkEnd(t){if(t.toPos)return{x:t.toPos.x,y:t.toPos.y};const e=this.nodes.find((e=>e.id===t.to));return e?{x:e.left+e.width/2,y:e.top+e.height/2}:{x:0,y:0}},computeTaperedBranch(t){const e=this.getNodeCenter(t.from),o=t.toPos?{x:t.toPos.x,y:t.toPos.y}:this.getNodeCenter(t.to);if(!e||!o)return"";const a=o.x-e.x,n=o.y-e.y,s=(e.x+o.x)/2,i=(e.y+o.y)/2,r=Math.hypot(a,n)||1,l=-n/r,d=a/r,c=(t.curvature||0)*r,h=s+l*c,u=i+d*c,p=30,m=[],g=[];for(let f=0;f<=p;f++){const a=f/p,n=(1-a)**2*e.x+2*(1-a)*a*h+a**2*o.x,s=(1-a)**2*e.y+2*(1-a)*a*u+a**2*o.y,i=l,r=d,c=(t.thickness||2)*(1-a);m.push(`${n+i*c/2},${s+r*c/2}`),g.unshift(`${n-i*c/2},${s-r*c/2}`)}return`M${m.join("L")}L${g.join("L")}Z`},computeRadialLinkPath(t){const e=this.getNodeCenter(t.from);if(!e)return"";const o=t.toPos?{x:t.toPos.x,y:t.toPos.y}:this.getNodeCenter(t.to);if(!o)return"";const a=this.$refs.canva.getBoundingClientRect(),n=a.width/2,s=a.height/2,i=e.x-n,r=e.y-s,l=Math.atan2(r,i),d=Math.hypot(i,r),c=o.x-n,h=o.y-s,u=Math.atan2(h,c),p=Math.hypot(c,h),m=d*Math.cos(l)+n,g=d*Math.sin(l)+s,f=p*Math.cos(u)+n,k=p*Math.sin(u)+s,y=(d+p)/2,b=y*Math.cos(l)+n,x=y*Math.sin(l)+s,L=y*Math.cos(u)+n,v=y*Math.sin(u)+s;return`M ${m},${g} C ${b},${x} ${L},${v} ${f},${k}`},midPoint(t){const e=this.getNodeCenter(t.from),o=t.toPos?{x:t.toPos.x,y:t.toPos.y}:this.getNodeCenter(t.to);if(!e||!o)return{x:0,y:0};if(!t.curvature)return{x:(e.x+o.x)/2,y:(e.y+o.y)/2};const a=o.x-e.x,n=o.y-e.y,s=Math.hypot(a,n)||1,i=(e.x+o.x)/2,r=(e.y+o.y)/2,l=-n/s,d=a/s;return{x:i+l*(t.curvature*s),y:r+d*(t.curvature*s)}},startAdjustCurvature(t){this.adjustingLink=t,window.addEventListener("mousemove",this.adjustCurvature),window.addEventListener("mouseup",this.endAdjustCurvature)},adjustCurvature(t){if(!this.adjustingLink)return;const e=this.adjustingLink,o=this.getNodeCenter(e.from),a=e.toPos?{x:e.toPos.x,y:e.toPos.y}:this.getNodeCenter(e.to);if(!o||!a)return;const n=this.$refs.canvas.getBoundingClientRect(),s=t.clientX-n.left,i=t.clientY-n.top,r=a.x-o.x,l=a.y-o.y,d=Math.hypot(r,l)||1,c=-l/d,h=r/d,u={x:(o.x+a.x)/2,y:(o.y+a.y)/2},p=s-u.x,m=i-u.y;e.curvature=(p*c+m*h)/d},endAdjustCurvature(){window.removeEventListener("mousemove",this.adjustCurvature),window.removeEventListener("mouseup",this.endAdjustCurvature),this.adjustingLink=null},selectLink(t){console.log("Chọn link:",t),this.selectedLink=t,this.selectedNode=null},clearSelection(){this.selectedNode=null,this.selectedLink=null},handleNodeClick(t){this.linking.active||this.selectNode(t)},selectNode(t){this.selectedNode=t,this.selectedLink=null,this.selectedColor=t.textColor||"#000000",this.selectedFont=t.fontFamily||"Arial",this.selectedAlign=t.align||"center",this.nodeBorderColor=t.borderColor,this.nodeBackgroundColor=t.backgroundColor,this.nodeBorderThickness=t.borderWidth,this.nodeBorderStyle=t.borderStyle,this.selectedFontSize=t.fontSize,this.updateNodeStyle(t)},handleLinkClick(t){this.selectionLink(t)},selectionLink(t){this.selectedLink=t,this.selectedNode=null,this.linkColor=t.color,this.linkThickness=t.thickness,this.linkDash=t.dash,this.linkCurvature=t.curvature,this.linkMarker=t.marker},initSelection(){this.nodes.length&&this.selectNode(this.nodes[0]),this.links.length&&this.selectionLink(this.links[0])},dragStart(t){this.currentDrag=t},drop(t){t.preventDefault();const e=this.currentDrag;if(!e)return;const o=t.currentTarget.getBoundingClientRect(),a=t.clientX-o.left,n=t.clientY-o.top;if("image"===e)this.uploadImage();else{const t={id:we++,type:e,left:a,top:n,width:"label"===e?100:120,height:"label"===e?40:80,text:"label"===e?"Nhập text...":"",rotation:0,font:{family:"Arial",size:14,bold:!1,italic:!1,color:"#000000",align:"center"},style:{borderColor:"#000000",borderWidth:this.defaultNodeBorderThickness,borderStyle:this.defaultNodeBorderStyle,backgroundColor:"#ffffff",custom:{}}};this.nodes.push(t)}this.currentDrag=null},removeNode(t){this.pushHistory();const e=t||this.selectedNode;if(!e)return;const o=new Set([e.id]);let a;do{a=!1,this.links.forEach((t=>{o.has(t.from)&&!o.has(t.to)&&(o.add(t.to),a=!0)}))}while(a);this.nodes=this.nodes.filter((t=>!o.has(t.id))),this.links=this.links.filter((t=>!o.has(t.from)&&!o.has(t.to))),this.selectedNode=null,this.selectedLink=null,this.linking&&(this.linking.active=!1,this.linking.fromNode=null,this.linking.tempPos={x:0,y:0}),this.pushHistory()},uploadImage(){document.getElementById("imageUploader").click()},handleFileSelect(t){const e=t.target.files[0];if(e){const t=new FileReader;t.onload=t=>{const e=t.target.result;this.nodes.push({id:we++,type:"image",left:50,top:50,width:150,height:100,image:e,borderColor:this.defaultNodeBorderColor,backgroundColor:this.defaultNodeBackgroundColor,borderThickness:this.defaultNodeBorderThickness,borderStyle:this.defaultNodeBorderStyle})},t.readAsDataURL(e)}},updateNodeText(t,e){e.text=t.target.innerHTML,this.updateNodeStyle(e)},toggleBold(){console.log("toggleBold called, selectedNode =",this.selectedNode),this.selectedNode?(this.selectedNode.isBold=!this.selectedNode.isBold,document.execCommand("bold"),this.updateNodeStyle(this.selectedNode),this.updateText(this.selectedNode)):this.selectedLink&&(this.selectedLink.isBold=!this.selectedLink.isBold)},toggleItalic(){this.selectedNode?(this.selectedNode.isItalic=!this.selectedNode.isItalic,document.execCommand("italic"),this.updateNodeStyle(this.selectedNode),this.updateText(this.selectedNode)):this.selectedLink&&(this.selectedLink.isItalic=!this.selectedLink.isItalic)},applyFontFamily(){this.selectedNode?(this.selectedNode.fontFamily=this.selectedFont,this.updateNodeStyle(this.selectedNode),this.updateText(this.selectedNode)):this.selectedLink&&(this.selectedLink.fontFamily=this.selectedFont)},applyTextColor(){this.selectedNode?(this.selectedNode.textColor=this.selectedColor,this.updateNodeStyle(this.selectedNode),this.updateText(this.selectedNode)):this.selectedLink&&(this.selectedLink.textColor=this.selectedColor)},applyFontSize(){this.selectedNode?(this.selectedNode.fontSize=this.selectedFontSize,this.updateNodeStyle(this.selectedNode),this.updateText(this.selectedNode)):this.selectedLink&&(this.selectedLink.fontSize=this.selectedFontSize)},setAlign(t){if(this.selectedNode)this.selectedNode.align=t,this.selectedAlign=t,document.execCommand("left"===t?"justifyLeft":"center"===t?"justifyCenter":"justifyRight"),this.updateNodeStyle(this.selectedNode),this.updateText(this.selectedNode);else if(this.selectedLink){let e="middle";"left"===t?e="start":"center"===t?e="middle":"right"===t&&(e="end"),this.selectedLink.align=e}},updateNodeStyle(t){this.$nextTick((()=>{const e=this.$el.querySelector(`.node[data-id="${t.id}"] .shape-inner`);e&&(e.style.fontWeight=t.isBold?"bold":"normal",e.style.fontStyle=t.isItalic?"italic":"normal",e.style.fontFamily=t.fontFamily||"",e.style.color=t.textColor,e.style.textAlign=t.align||"center",e.style.fontSize=`${t.fontSize}px`||"12px")}))},updateNode(t){if(!t||null==t.id)return void console.warn("Không có node để cập nhật",t);t.backgroundColor=this.nodeBackgroundColor,t.borderColor=this.nodeBorderColor,t.borderWidth=this.nodeBorderThickness,t.borderStyle=this.nodeBorderStyle,console.log("updateNodeStyle",t.id,t.borderWidth);const e=Le.Ltv(this.$refs.canva).select(`g.node-group[data-id='${t.id}']`);console.log(Le.Ltv(this.$refs.canva).selectAll("g.node-group").nodes()),e.empty()?console.warn("Không tìm thấy node-group với id",t.id):e.selectAll("circle.node-shape, ellipse.node-shape, rect.node-shape").attr("fill",t.backgroundColor).attr("stroke",t.borderColor).attr("stroke-width",t.borderWidth).attr("stroke-dasharray","dashed"===t.borderStyle?"4,2":"dotted"===t.borderStyle?"1,2":null)},updateText(t){console.log("updateText",t.id,t.textColor);const e=Le.Ltv(this.$refs.canva).select(`g.node-group[data-id='${t.id}']`);e.select("text").attr("font-size",t.fontSize).attr("font-weight",t.isBold?"bold":"normal").attr("font-style",t.isItalic?"italic":"normal").style("fill",t.textColor).attr("font-family",t.fontFamily)},updateLink(t){if(!t||null==t.from)return;const e=Le.Ltv(this.$refs.canvas).select(`path.link[data-id="${t.id}"]`);e.attr("stroke",t.color).attr("stroke-width",t.thickness).attr("stroke-dasharray",this.dashArray(t.dash)).attr("marker-end","none"===t.marker?null:`url(#${t.marker})`)},startDragNode(t,e){this.linkMode||(this.draggingNode=t,this.offsetX=e.clientX-t.left,this.offsetY=e.clientY-t.top,window.addEventListener("mousemove",this.doDragNode),window.addEventListener("mouseup",this.stopDragNode))},doDragNode(t){if(!this.draggingNode)return;this.draggingNode.left=t.clientX-this.offsetX,this.draggingNode.top=t.clientY-this.offsetY;const e=this.draggingNode.left+this.draggingNode.width/2,o=this.draggingNode.top+this.draggingNode.height/2;let a=!1;this.links.forEach((t=>{t.attachedTo===this.draggingNode.id&&t.toPos&&(t.toPos.x=e,t.toPos.y=o,t.path=this.computeLinkPath(t),a=!0)})),a||console.log("")},stopDragNode(){window.removeEventListener("mousemove",this.doDragNode),window.removeEventListener("mouseup",this.stopDragNode),this.draggingNode=null},startResize(t,e,o){this.resizingNode=t,this.resizeDir=o,this.startX=e.clientX,this.startY=e.clientY,this.startW=t.width,this.startH=t.height,this.startL=t.left,this.startT=t.top,window.addEventListener("mousemove",this.doResize),window.addEventListener("mouseup",this.stopResize)},doResize(t){if(!this.resizingNode)return;const e=t.clientX-this.startX,o=t.clientY-this.startY;let a=this.startW,n=this.startH,s=this.startL,i=this.startT;switch(this.resizeDir){case"top-left":a=Math.max(30,this.startW-e),n=Math.max(30,this.startH-o),s=this.startL+e,i=this.startT+o;break;case"top-center":n=Math.max(30,this.startH-o),i=this.startT+o;break;case"top-right":a=Math.max(30,this.startW+e),n=Math.max(30,this.startH-o),i=this.startT+o;break;case"mid-left":a=Math.max(30,this.startW-e),s=this.startL+e;break;case"mid-right":a=Math.max(30,this.startW+e);break;case"bottom-left":a=Math.max(30,this.startW-e),n=Math.max(30,this.startH+o),s=this.startL+e;break;case"bottom-center":n=Math.max(30,this.startH+o);break;case"bottom-right":a=Math.max(30,this.startW+e),n=Math.max(30,this.startH+o);break}this.resizingNode.width=a,this.resizingNode.height=n,this.resizingNode.left=s,this.resizingNode.top=i},stopResize(){window.removeEventListener("mousemove",this.doResize),window.removeEventListener("mouseup",this.stopResize),this.resizingNode=null,this.resizeDir=null},getNodeCenter(t){const e="object"===typeof t?t:this.nodes.find((e=>e.id===t));return e?{x:e.left+e.width/2,y:e.top+e.height/2}:null},shapeInnerStyle(t){if("label"===t.type)return{width:"100%",height:"100%",backgroundColor:"transparent",border:"none",padding:"0 4px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",userSelect:"none",fontWeight:t.isBold?"bold":"normal",fontStyle:t.isItalic?"italic":"normal",fontFamily:t.fontFamily||"",color:t.textColor||"#000",textAlign:t.align||"center",fontSize:`${t.fontSize}px`};const e=t.borderColor||this.defaultNodeBorderColor,o=void 0!==t.borderThickness?t.borderThickness:this.defaultNodeBorderThickness,a=t.borderStyle||this.defaultNodeBorderStyle,n=t.backgroundColor||this.defaultNodeBackgroundColor;let s={width:"100%",height:"100%",backgroundColor:n,display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",padding:"5px",textAlign:"center",whiteSpace:"normal",wordWrap:"break-word"};return"circle"===t.type?(s.borderRadius="50%",s.border=o+"px "+a+" "+e):(s.borderRadius="5px",s.border=o+"px "+a+" "+e),s},beginLink(t,e){const o=this.$refs.canvas;if(!o)return;const a=o.getBoundingClientRect();this.linking.active=!0,this.linking.fromNode=t,this.linking.tempPos={x:e.clientX-a.left,y:e.clientY-a.top},window.addEventListener("mousemove",this.trackLink),window.addEventListener("mouseup",this.endLink)},trackLink(t){if(!this.linking.active)return;const e=this.$refs.canvas;if(!e)return;const o=e.getBoundingClientRect();this.linking.tempPos={x:t.clientX-o.left,y:t.clientY-o.top}},endLink(t){if(!this.linking.fromNode)return;const e=document.elementFromPoint(t.clientX,t.clientY),o=e&&e.closest(".node"),a=this.$refs.canvas.getBoundingClientRect();if(o){const t=Number(o.dataset.id),e=this.getNodeCenter(t);if(!e)return alert("Không thể nối ngược node với id = "+t),void(this.linking={});this.links.push({from:this.linking.fromNode.id,toPos:{x:e.x,y:e.y},attachedTo:t,color:this.defaultLinkColor,thickness:this.defaultLinkThickness,dash:this.defaultLinkDash,curvature:this.defaultLinkCurvature,marker:this.defaultLinkMarker,text:"",isBold:!1,isItalic:!1,align:"middle",textColor:this.selectedColor,fontSize:12,fontFamily:"Arial"})}else{const e=t.clientX-a.left,o=t.clientY-a.top;if(e<0||o<0)return alert("Vị trí vẽ link không hợp lệ."),void(this.linking={});this.links.push({from:this.linking.fromNode.id,toPos:{x:e,y:o},attachedTo:null,color:this.defaultLinkColor,thickness:this.defaultLinkThickness,dash:this.defaultLinkDash,curvature:this.defaultLinkCurvature,marker:this.defaultLinkMarker,text:"",isBold:!1,isItalic:!1,align:"middle",textColor:this.selectedColor,fontSize:12,fontFamily:"Arial"})}this.linking.active=!1,this.linking.fromNode=null},getLinkPath(t,e,o=!1,a=0){const n=this.getNodeCenter(t),s=o?e:this.getNodeCenter(e);if(!n||!s)return"";if(0===a)return`M${n.x},${n.y} L${s.x},${s.y}`;const i=s.x-n.x,r=s.y-n.y,l=(n.x+s.x)/2,d=(n.y+s.y)/2,c=Math.hypot(i,r)||1,h=-r/c,u=i/c,p=l+h*a*c,m=d+u*a*c;return`M${n.x},${n.y} Q${p},${m} ${s.x},${s.y}`},dashArray(t){return"dashed"===t?"5,5":"dotted"===t?"2,2":""},inlineAllStyles(t){const e=t=>{const o=getComputedStyle(t);["fill","stroke","font-size","font-family","font-weight","opacity"].forEach((e=>t.style.setProperty(e,o.getPropertyValue(e))));for(let a of t.children)e(a)};e(t)},async exportImage(){const t=this.$refs.canvas;if(t){t.setAttribute("width",t.clientWidth+1e3),t.setAttribute("height",t.clientHeight+400),this.inlineAllStyles(t);try{const e=await ve.$E(t,{backgroundColor:"white",width:t.clientWidth+1e3,height:t.clientHeight+400,pixelRatio:2}),o=document.createElement("a");o.download=`${this.form.mapTitle||"mindmap"}.png`,o.href=e,document.body.appendChild(o),o.click(),document.body.removeChild(o)}catch(e){console.error("Lỗi khi xuất ảnh:",e)}}}}};const Me=(0,R.A)(Ce,[["render",xe],["__scopeId","data-v-78df5db6"]]);var Ne=Me;const Se={class:"AI"},Ie={class:"toolbarAI"},Te={class:"toolbarAI_left"},$e={class:"toolbarAI_right"},Ae={class:"map-type-select"},Ee=["disabled"],Pe=["disabled"],Be={class:"panel"},Fe={class:"suggetion-list"},ze=["onClick"],Oe=["src"],De={class:"title"},We={class:"mindmap-display"},Ue={ref:"mindmapSvg",class:"mindmap-svg"},je=["src"],_e={class:"input-container"},Xe={key:0,class:"creating-status"},Re={class:"file-upload"},Je={key:0,class:"modal-backdrop"},He={class:"modal"},Ve={class:"modal-actions"};function Ge(t,e,o,s,i,l){return(0,n.uX)(),(0,n.CE)("div",Se,[(0,n.Lk)("div",Ie,[(0,n.Lk)("div",Te,[e[14]||(e[14]=(0,n.Lk)("button",null,[(0,n.Lk)("a",{href:"./CreateMM"},[(0,n.Lk)("span",null,"«"),(0,n.eW)(" Tự tạo sơ đồ tư duy")])],-1)),(0,n.Lk)("button",{onClick:e[0]||(e[0]=(...t)=>l.toggleSuggestions&&l.toggleSuggestions(...t))},e[13]||(e[13]=[(0,n.Lk)("i",{class:"fa-solid fa-lightbulb"},null,-1),(0,n.eW)(" Gợi ý")]))]),(0,n.Lk)("div",$e,[(0,n.Lk)("label",Ae,[(0,n.bo)((0,n.Lk)("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>i.selectedMapType=t)},e[15]||(e[15]=[(0,n.Fv)('<option value="bubble" data-v-655a8440>Bubble Map</option><option value="tree" data-v-655a8440>Tree Map</option><option value="flow" data-v-655a8440>Flow Map</option><option value="multiFlow" data-v-655a8440>Multi Flow Map</option><option value="brace" data-v-655a8440>Brace Map</option>',5)]),512),[[a.u1,i.selectedMapType]])]),(0,n.Lk)("button",{onClick:e[2]||(e[2]=(...t)=>l.saveTemplate&&l.saveTemplate(...t)),disabled:!l.canSave},e[16]||(e[16]=[(0,n.Lk)("i",{class:"fa-solid fa-floppy-disk"},null,-1),(0,n.eW)(" Save")]),8,Ee),(0,n.Lk)("button",{onClick:e[3]||(e[3]=(...t)=>l.exportImage&&l.exportImage(...t))},e[17]||(e[17]=[(0,n.Lk)("i",{class:"fa-solid fa-image"},null,-1),(0,n.eW)(" Xuất hình ảnh")])),(0,n.Lk)("button",{onClick:e[4]||(e[4]=(...t)=>l.exportPPT&&l.exportPPT(...t)),disabled:!i.mindmapObject},e[18]||(e[18]=[(0,n.Lk)("i",{class:"fa-solid fa-file-powerpoint"},null,-1),(0,n.eW)(" Xuất PowerPoint")]),8,Pe)])]),(0,n.Lk)("div",Be,[(0,n.Lk)("div",{class:(0,r.C4)(["left-panel",{hidden:!i.showSuggestion}])},[e[19]||(e[19]=(0,n.Lk)("h3",null,"Gợi ý sơ đồ tư duy",-1)),(0,n.Lk)("ul",Fe,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(i.suggestions,(t=>((0,n.uX)(),(0,n.CE)("li",{key:t._id,class:"suggestion-item"},[(0,n.Lk)("button",{onClick:e=>l.selectTemplate(t)},[(0,n.Lk)("img",{src:t.imageUrl,alt:"template thumbnail",class:"thumb"},null,8,Oe),(0,n.Lk)("span",De,(0,r.v_)(t.title),1)],8,ze)])))),128))])],2),(0,n.Lk)("div",{class:(0,r.C4)(["right-panel",{full:!o.showSuggestions}])},[(0,n.Lk)("div",We,[(0,n.bo)(((0,n.uX)(),(0,n.CE)("svg",Ue,null,512)),[[a.aG,!i.selectedImageUrl]]),(0,n.bo)((0,n.Lk)("img",{src:i.selectedImageUrl,class:"mindmap-image"},null,8,je),[[a.aG,i.selectedImageUrl]])]),(0,n.Lk)("div",_e,[i.creatingTopic?((0,n.uX)(),(0,n.CE)("div",Xe,[e[20]||(e[20]=(0,n.eW)(" Đang tạo sơ đồ tư duy cho ")),(0,n.Lk)("strong",null,(0,r.v_)(i.creatingTopic),1),e[21]||(e[21]=(0,n.eW)("… "))])):((0,n.uX)(),(0,n.CE)(n.FK,{key:1},[(0,n.bo)((0,n.Lk)("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=t=>i.topic=t),placeholder:"Nhập chủ đề hoặc ý tưởng...",onKeypress:e[6]||(e[6]=(0,a.jR)(((...t)=>l.generateMindMap&&l.generateMindMap(...t)),["enter"]))},null,544),[[a.Jo,i.topic]]),(0,n.bo)((0,n.Lk)("select",{"onUpdate:modelValue":e[7]||(e[7]=t=>i.selectOption=t),class:"option-select"},e[22]||(e[22]=[(0,n.Lk)("option",{value:"no-image"},"Không kèm ảnh",-1),(0,n.Lk)("option",{value:"with-image"},"Kèm ảnh",-1)]),512),[[a.u1,i.selectOption]]),(0,n.Lk)("button",{class:"create-btn",onClick:e[8]||(e[8]=(...t)=>l.generateMindMap&&l.generateMindMap(...t))},e[23]||(e[23]=[(0,n.Lk)("i",{class:"fa-solid fa-brain"},null,-1),(0,n.eW)(" Tạo sơ đồ ")])),(0,n.Lk)("label",Re,[e[24]||(e[24]=(0,n.Lk)("span",null,[(0,n.Lk)("i",{class:"fa-solid fa-file-arrow-up"})],-1)),(0,n.Lk)("input",{type:"file",onChange:e[9]||(e[9]=(...t)=>l.onFileChange&&l.onFileChange(...t))},null,32)])],64))])],2)]),i.showSaveModal?((0,n.uX)(),(0,n.CE)("div",Je,[(0,n.Lk)("div",He,[e[25]||(e[25]=(0,n.Lk)("h3",null,"Đặt tên sơ đồ tư duy",-1)),(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":e[10]||(e[10]=t=>i.form.mapTitle=t),placeholder:"Tên sơ đồ tư duy"},null,512),[[a.Jo,i.form.mapTitle]]),(0,n.Lk)("div",Ve,[(0,n.Lk)("button",{onClick:e[11]||(e[11]=(...t)=>l.confirmSave&&l.confirmSave(...t))},"Lưu"),(0,n.Lk)("button",{onClick:e[12]||(e[12]=t=>i.showSaveModal=!1)},"Huỷ")])])])):(0,n.Q3)("",!0)])}o(4979);var qe=o(9865),Ye={name:"CreateAIMindMap",props:{showSuggestions:{type:Boolean,default:!0}},data(){return{topic:"",fileContent:null,mindmapObject:null,suggestions:[],showSuggestion:!0,selectOption:"no-image",selectedImageUrl:null,showSaveModal:!1,form:{mapTitle:""},selectedMapType:"tree",leafImages:{},file:null,creatingTopic:"",nodes:[],links:[]}},watch:{mindmapObject(t){t&&this.drawMindMap()}},computed:{canSave(){return!(!this.selectedImageUrl&&!this.mindmapObject)}},mounted(){this.fetchSuggestions()},methods:{selectTemplate(t){console.log("selected item =",t),this.mindmapObject=t.mindmapData,this.selectedMapType=t.mapType,this.$nextTick((()=>{console.log("Drawing",this.selectedMapType,this.mindmapObject),this.drawMindMap()}))},async fetchSuggestions(){try{const t=localStorage.getItem("token"),e=await fetch("/api/listMindmap",{headers:{Authorization:`Bearer ${t}`}});if(!e.ok)throw new Error(e.statusText);const o=await e.json();this.suggestions=Array.isArray(o)?o:Array.isArray(o.list)?o.list:[]}catch(t){console.error("Lấy gợi ý thất bại:",t)}},toggleSuggestions(){this.selectedImageUrl=null,this.showSuggestion=!this.showSuggestion},onFileChange(t){this.file=t.target.files[0]||null},async generateMindMap(){if(this.creatingTopic)return;const t=this.file?this.file.name:this.topic.trim();if(!t)return alert("Nhập chủ đề hoặc chọn file");this.creatingTopic=t;const e=new FormData;e.append("topic",t),e.append("withImage","with-image"===this.selectOption),this.file&&e.append("file",this.file);try{const t=await fetch("/api/generateMindmap",{method:"POST",body:e}),o=await t.json();this.mindmapObject=o.mindmap,this.drawMindMap(),this.topic="",o.image&&(this.selectedImageUrl=o.image)}catch(o){alert("Có lỗi khi tạo sơ đồ")}finally{this.creatingTopic=""}},_generateImageFromSvg(){const t=this.$refs.mindmapSvg,e=t.cloneNode(!0);e.setAttribute("xmlns","http://www.w3.org/2000/svg");const o=t.clientWidth,a=t.clientHeight;e.setAttribute("width",o),e.setAttribute("height",a);const n="http://www.w3.org/2000/svg",s=document.createElementNS(n,"rect");s.setAttribute("x",0),s.setAttribute("y",0),s.setAttribute("width",o),s.setAttribute("height",a),s.setAttribute("fill","#fff"),e.insertBefore(s,e.firstChild);const i=(new XMLSerializer).serializeToString(e),r=btoa(unescape(encodeURIComponent(i)));return new Promise(((t,e)=>{const n=new Image;n.onload=()=>{const e=document.createElement("canvas");e.width=o,e.height=a;const s=e.getContext("2d");s.drawImage(n,0,0),t(e.toDataURL("image/png"))},n.onerror=e,n.src="data:image/svg+xml;base64,"+r}))},saveTemplate(){this.canSave&&(this.showSaveModal=!0,this.form.mapTitle="")},async confirmSave(){const t=this.form.mapTitle.trim();if(!t)return alert("Nhập tên sơ đồ tư duy");if(!this.selectedImageUrl){await this.$nextTick();try{this.selectedImageUrl=await this._generateImageFromSvg()}catch(e){return console.error("Chuyển SVG → ảnh thất bại:",e),alert("Không thể tạo ảnh từ SVG!")}}await this._postSave(t)},async _postSave(t){try{const e=localStorage.getItem("token"),o=JSON.parse(JSON.stringify((0,B.ux)(this.mindmapObject))),a={title:t,type:"ai",mapType:this.selectedMapType,mindmapData:o,imageUrl:this.selectedImageUrl},n=await fetch("/api/listMindmap",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(a)});if(!n.ok){const t=await n.json();throw new Error(t.error||"Lưu thất bại")}alert("Lưu thành công"),this.showSaveModal=!1}catch(e){alert("Lỗi khi lưu: "+e.message)}},inlineAllStyles(t){const e=t=>{const o=getComputedStyle(t);["fill","stroke","font-size","font-family","font-weight","opacity"].forEach((e=>t.style.setProperty(e,o.getPropertyValue(e))));for(let a of t.children)e(a)};e(t)},exportImage(){const t=this.$refs.mindmapSvg;t&&(t.setAttribute("width",t.clientWidth+1e3),t.setAttribute("height",t.clientHeight+400),this.inlineAllStyles(t),(0,qe.saveSvgAsPng)(t,(this.form.mapTitle||"mindmap")+".png",{backgroundColor:"white",scale:2}))},async exportPPT(){try{const t=this.mindmapObject;if(!t||"string"!==typeof t.root||!Array.isArray(t.branches))return alert("Dữ liệu sơ đồ không đúng định dạng!");const e=new window.PptxGenJS;let o=e.addSlide();o.addText(t.root,{x:.5,y:.5,fontSize:32,bold:!0}),t.branches.forEach((t=>{o=e.addSlide(),o.addText(t.title,{x:.5,y:.5,fontSize:24,bold:!0,color:"0055A5"});let a=1.2;this.selectedImageUrl&&(o.addImage({path:this.selectedImageUrl,x:.5,y:1,w:4,h:3}),a=4.2),Array.isArray(t.subBranches)&&t.subBranches.length&&t.subBranches.forEach(((t,e)=>{const n="string"===typeof t.title?t.title:JSON.stringify(t);o.addText(n,{x:.7,y:a+.5*e,fontSize:18,bullet:!0,margin:.05})}))})),console.log("Total slides:",e.slides.length),await e.writeFile({fileName:"MindMap_Presentation.pptx"}),alert("Đã xuất PPT thành công!")}catch(t){console.error("Export PPT error:",t),alert("Lỗi khi xuất PPT: "+t.message)}},textWidth(t){const e=document.createElement("canvas").getContext("2d");return e.font="12px sans-serif",e.measureText(t).width},drawMindMap(){if(!this.mindmapObject)return;const t=Le.Ltv(this.$refs.mindmapSvg);switch(t.selectAll("*").remove(),t.attr("width","100vw").attr("height","100vh"),this.selectedMapType){case"bubble":this.drawBubbleMap(t);break;case"tree":this.drawTreeMap(t);break;case"flow":this.drawFlowMap(t);break;case"multiFlow":this.drawMultiFlowMap(t);break;case"brace":this.drawBraceMap(t);break}},drawTreeMap(t){const e=this,o=t.node().clientWidth,a=t.node().clientHeight,n=Math.min(o,a)/2-80,s=12,i=800,r=.5,l=3,d=t.append("g").attr("transform",`translate(${o/2},${a/2}) rotate(0)`);t.call(Le.s_O().scaleExtent([r,l]).on("zoom",(({transform:t})=>d.attr("transform",t))));const c=Le.Sk5(e.buildHierarchy(e.mindmapObject));Le.bzR().size([2*Math.PI,n])(c),c.each((t=>{if(0===t.depth)t.yOffset=0;else{const o=e.textWidth(t.data.name);t.yOffset=t.parent.yOffset+o+s}}));const h=Le.e7Y().angle((t=>t.x)).radius((t=>t.yOffset));d.append("g").selectAll("path").data(c.links()).enter().append("path").attr("class","link").attr("id",((t,e)=>`link${e}`)).attr("d",(t=>{const o=h(t),a=t.target.x-Math.PI/2,n=t.target.yOffset,i=e.textWidth(t.target.data.name)+s,r=(n+i)*Math.cos(a),l=(n+i)*Math.sin(a);return`${o}L${r},${l}`})).attr("fill","none").attr("stroke","aqua").attr("stroke-width",(t=>0===t.source.depth?8:2)).attr("stroke-dasharray",(function(){const t=this.getTotalLength();return`${t} ${t}`})).attr("stroke-dashoffset",(function(){return this.getTotalLength()})).transition().duration(i).ease(Le.TD8).attr("stroke-dashoffset",0).on("end",(()=>{this.creatingTopic=""})),d.append("g").selectAll("text").data(c.links()).enter().append("text").append("textPath").attr("xlink:href",((t,e)=>`#link${e}`)).attr("startOffset",(t=>1===t.target.depth?"35%":"50%")).style("font-size",(t=>1===t.target.depth?"14px":"10px")).style("fill","#333").text((t=>t.target.data.name));const u=c.data.root||c.data.name,p=e.textWidth(u),m=d.append("g").attr("transform","translate(0,20)");m.append("ellipse").attr("rx",p/2+s).attr("ry",s+7).attr("fill","#fff").attr("stroke","#333").attr("stroke-width",2),m.append("text").text(u).attr("text-anchor","middle").attr("dy","0.35em").style("font-size","14px").style("font-weight","bold")},wrapText(t,e,o=1.2){t.each((function(){const t=Le.Ltv(this),a=t.text().split(/\s+/);t.text(null);let n=[];const s=t.attr("x"),i=t.attr("y"),r=parseFloat(t.attr("dy"))||0;let l=t.append("tspan").attr("x",s).attr("y",i).attr("dy",`${r}em`);for(let d=0;d<a.length;d++)n.push(a[d]),l.text(n.join(" ")),l.node().getComputedTextLength()>e&&n.length>1&&(n.pop(),l.text(n.join(" ")),n=[a[d]],l=t.append("tspan").attr("x",s).attr("y",i).attr("dy",`${o}em`).text(a[d]))}))},chunkText(t,e=3){const o=t.split(/\s+/),a=[];for(let n=0;n<o.length;n+=e)a.push(o.slice(n,n+e).join(" "));return a},drawBubbleMap(t){const e=this,o=t.node().clientWidth,a=t.node().clientHeight,n=o/2,s=a/2;t.selectAll("*").remove();const i=t.append("g");t.call(Le.s_O().scaleExtent([.5,3]).on("zoom",(({transform:t})=>i.attr("transform",t))));const r=e.buildHierarchy(e.mindmapObject),l=r.children||[],d=Math.max(1,l.length),c=8,h="16px sans-serif",u="12px sans-serif",p=120,m=60,g=60;function f(t,o,a,n,s){const r=t.name.split(/\s+/),l=[];for(let e=0;e<r.length;e+=3)l.push(r.slice(e,e+3).join(" "));const k=0===n?h:u,y=Math.max(...l.map((t=>e.textWidth(t,k)))),b=0===n?80:40,x=Math.max(b,y/2+c),L=i.append("circle").attr("cx",o).attr("cy",a).attr("r",x).attr("fill",0===n?"aqua":"white").attr("stroke",0===n?"#333":"#007bff").attr("stroke-width",0===n?2:1.5).attr("opacity",0),v=i.append("text").attr("x",o).attr("y",a-6*(l.length-1)).attr("text-anchor","middle").attr("dominant-baseline","middle").style("font-size",0===n?"18px":1===n?"14px":"10px").style("fill","#333").attr("opacity",0);l.forEach(((t,e)=>{v.append("tspan").attr("x",o).attr("dy",0===e?"0em":"1.2em").text(t)}));const w=t.children||[];if(!w.length)return L.transition().delay(400).duration(300).attr("opacity",1),void v.transition().delay(400).duration(300).attr("opacity",1);if(0===n){const t=2*Math.PI/d;for(let e=0;e<d;e++){const n=-Math.PI/2+t/2+e*t,s=p,r=o+Math.cos(n)*x,l=a+Math.sin(n)*x,d=o+Math.cos(n)*(x+s),c=a+Math.sin(n)*(x+s);i.append("line").attr("x1",r).attr("y1",l).attr("x2",r).attr("y2",l).attr("stroke","#aaa").attr("stroke-width",2).transition().duration(500).attr("x2",d).attr("y2",c).on("end",(()=>{L.transition().duration(300).attr("opacity",1),v.transition().duration(300).attr("opacity",1),f(w[e],d,c,1,n)}))}}else{const t=2*Math.PI/d,e=s-t/2,r=w.length;for(let s=0;s<r;s++){const l=e+t*(s/(r-1||1));let d=m+20*(r-1);w[s].children?.length||(d+=g);const c=o+Math.cos(l)*x,h=a+Math.sin(l)*x,u=o+Math.cos(l)*(x+d),p=a+Math.sin(l)*(x+d);i.append("line").attr("x1",c).attr("y1",h).attr("x2",c).attr("y2",h).attr("stroke","#aaa").attr("stroke-width",2).transition().duration(500).attr("x2",u).attr("y2",p).on("end",(()=>{L.transition().duration(300).attr("opacity",1),v.transition().duration(300).attr("opacity",1),f(w[s],u,p,n+1,l)}))}}}f(r,n,s,0,0)},drawFlowMap(t){const e=this;t.selectAll("*").remove();const o=t.append("defs");o.append("marker").attr("id","arrow").attr("viewBox","0 -5 10 10").attr("refX",10).attr("refY",0).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("path").attr("d","M0,-5L10,0L0,5").attr("fill","#888");const a=o.append("linearGradient").attr("id","nodeGradient").attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","100%");a.append("stop").attr("offset","0%").attr("stop-color","#ffffff"),a.append("stop").attr("offset","100%").attr("stop-color","#e0f7fa");const n=200,s=20,i=t.append("g").attr("transform",`translate(${n},${s})`);t.call(Le.s_O().scaleExtent([.1,4]).on("zoom",(({transform:t})=>i.attr("transform",t))));const r=e.buildHierarchy(e.mindmapObject),l=Le.Sk5(r),d=Le.B22().nodeSize([80,200]).separation(((t,e)=>t.parent===e.parent?1:2));d(l);const c=Le.pqs().x((t=>t.y)).y((t=>t.x));function h(t){const e=t.split(/\s+/),o=[];for(let a=0;a<e.length;a+=3)o.push(e.slice(a,a+3).join(" "));return o}i.selectAll("path.link").data(l.links()).enter().append("path").attr("class","link").attr("d",c).attr("fill","none").attr("stroke","aqua").attr("stroke-width",2).attr("marker-end","url(#arrow)").attr("stroke-dasharray",(function(){const t=this.getTotalLength();return`${t} ${t}`})).attr("stroke-dashoffset",(function(){return this.getTotalLength()})).transition().delay((t=>300*t.source.depth)).duration(600).ease(Le.yfw).attr("stroke-dashoffset",0);const u=i.selectAll("g.node").data(l.descendants()).enter().append("g").attr("class","node").attr("transform",(t=>{const e=1===t.depth?100:0;return`translate(${t.y+e},${t.x})`}));u.each(((t,o,a)=>{const n=Le.Ltv(a[o]),s=h(t.data.name),i=20,r=Math.max(8,i-2*t.depth),l=`${r}px sans-serif`;if(0===t.depth){const t=Math.min(200,Math.max(...s.map((t=>e.textWidth(t,l))))),o=t/2+20;n.append("circle").attr("r",o).attr("fill","url(#nodeGradient)").attr("stroke","#333").attr("stroke-width",4);const a=n.append("text").attr("text-anchor","middle").attr("dominant-baseline","middle").style("font-size",l).style("font-weight","bold");s.forEach(((t,e)=>{a.append("tspan").attr("x",0).attr("dy",0===e?`-${.6*(s.length-1)}em`:"1.2em").text(t)}))}else{const o=6,a=4,i=Math.max(...s.map((t=>e.textWidth(t,l)))),r=i+6*o,d=20*s.length+2*a;n.append("rect").attr("x",t.children?-r-4:4).attr("y",-d/2).attr("width",r).attr("height",d).attr("rx",4).attr("ry",4).attr("fill","url(#nodeGradient)").attr("stroke","#007bff").attr("stroke-width",1.5);const c=n.append("text").attr("text-anchor",t.children?"end":"start").attr("dominant-baseline","middle").style("font-size",l);if(this.includeImage&&this.leafImages[t.data.name]){const e=t.children?-r-10:r+10;n.append("image").attr("href",this.leafImages[t.data.name]).attr("x",e).attr("y",-d/2).attr("width",50).attr("height",50)}s.forEach(((e,a)=>{c.append("tspan").attr("x",t.children?-o-4:o+4).attr("dy",0===a?`-${.6*(s.length-1)}em`:"1.2em").text(e)}))}}))},drawMultiFlowMap(t){const e=this,o=t.node().clientWidth,a=t.node().clientHeight;t.selectAll("*").remove();const n=t.append("defs");n.append("marker").attr("id","arrow").attr("viewBox","0 -5 10 10").attr("refX",5).attr("refY",0).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("path").attr("d","M0,-5L10,0L0,5").attr("fill","#888");const s=n.append("linearGradient").attr("id","nodeGradient").attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","100%");s.append("stop").attr("offset","0%").attr("stop-color","#ffffff"),s.append("stop").attr("offset","100%").attr("stop-color","#e0f7fa");const i=t.append("g").attr("transform",`translate(${o/2},${a/2})`);function r(t){"string"!==typeof t&&(t="");const e=t.split(/\s+/),o=[];for(let a=0;a<e.length;a+=3)o.push(e.slice(a,a+3).join(" "));return o}t.call(Le.s_O().scaleExtent([.1,4]).on("zoom",(({transform:t})=>i.attr("transform",t))));const l=e.buildHierarchy(e.mindmapObject),d=l.children||[],c=Math.ceil(d.length/2),h=d.slice(0,c),u=d.slice(c),p=Le.Sk5({children:h},(t=>t.children)),m=Le.Sk5({children:u},(t=>t.children)),g=100,f=300,k=Le.B22().nodeSize([g,f]).separation(((t,e)=>t.parent===e.parent?1:2));k(p),k(m);const y=p.descendants().map((t=>t.x)),b=m.descendants().map((t=>t.x)),x=(Le.jkA(y)+Le.T9B(y))/2,L=(Le.jkA(b)+Le.T9B(b))/2,v=r(l.name),w=20,C=`${w}px sans-serif`,M=Math.min(200,Math.max(...v.map((t=>e.textWidth(t,C))))),N=M/2+20,S=30,I=6,T=4,$=4,A=-80,E=100;function P(t,o){const a=Math.max(8,w-2*o),n=`${a}px sans-serif`,s=r(t),i=Math.max(...s.map((t=>e.textWidth(t,n)))),l=i+6*I;return l/2+$}const B=(t,e)=>{const o=Le.pqs().x((t=>e?-t.y:t.y)).y((t=>t.x));i.append("g").selectAll("path.link").data(t.links()).enter().append("path").attr("class","link").attr("fill","none").attr("stroke","aqua").attr("stroke-width",2).attr("marker-end","url(#arrow)").attr("stroke-dasharray",(function(){const t=this.getTotalLength();return`${t} ${t}`})).attr("stroke-dashoffset",(function(){return this.getTotalLength()})).attr("d",(t=>{const a=t.source.x-(e?L:x),n=t.target.x-(e?L:x),s=t.source.y+(0===t.source.depth?e?-N:N:0);let i=t.target.y;const r=P(t.target.data.name,t.target.depth);return e||1!==t.target.depth||(i+=r),e&&!t.target.children&&(i-=r),o({source:{x:a,y:s},target:{x:n,y:i}})})).transition().delay((t=>300*t.source.depth)).duration(600).ease(Le.yfw).attr("stroke-dashoffset",0)};B(p,!0),B(m,!1);const F=i.append("g").attr("transform",`translate(${S},0)`);F.append("circle").attr("r",N).attr("fill","url(#nodeGradient)").attr("stroke","#333").attr("stroke-width",4);const z=F.append("text").attr("text-anchor","middle").attr("dominant-baseline","middle").style("font-size",C).style("font-weight","bold");v.forEach(((t,e)=>{z.append("tspan").attr("x",0).attr("dy",0===e?`-${.6*(v.length-1)}em`:"1.2em").text(t)}));const O=(t,o)=>{i.append("g").selectAll("g.node").data(t.descendants().slice(1)).enter().append("g").attr("class","node").attr("transform",(t=>{const e=t.x-(o?L:x);let a=t.y;o||1!==t.depth||(a+=E),o&&!t.children&&(a-=A);const n=o?-a:a;return`translate(${n},${e})`})).each((function(t){const o=Le.Ltv(this),a=r(t.data.name),n=Math.max(8,w-2*t.depth),s=`${n}px sans-serif`,i=Math.max(...a.map((t=>e.textWidth(t,s)))),l=i+6*I,d=20*a.length+2*T;o.append("rect").attr("x",t.children?-l-4:4).attr("y",-d/2).attr("width",l).attr("height",d).attr("rx",4).attr("ry",4).attr("fill","url(#nodeGradient)").attr("stroke","#007bff").attr("stroke-width",1.5);const c=o.append("text").attr("text-anchor",t.children?"end":"start").attr("dominant-baseline","middle").style("font-size",s);a.forEach(((e,o)=>{c.append("tspan").attr("x",t.children?-I-4:I+4).attr("dy",0===o?`-${.6*(a.length-1)}em`:"1.2em").text(e)}))}))};O(p,!0),O(m,!1)},drawBraceMap(t){const e=t.node().clientWidth,o=t.node().clientHeight;t.selectAll("*").remove();const a=Le.Sk5(this.buildHierarchy(this.mindmapObject));Le.B22().size([e-100,o-100])(a);const n=a.children?a.children.length:0;a.x=200*n;const s=t.append("g").attr("transform",`translate(${e/2},20)`);t.call(Le.s_O().scaleExtent([.5,3]).on("zoom",(({transform:t})=>{s.attr("transform",`translate(${t.x+e/2},${t.y+20}) scale(${t.k})`)})));const i=100,r=120,l=500;(a.children||[]).forEach(((t,e)=>{t.x=e*l})),a.children.forEach((t=>{const e=t.children||[],o=e.length;e.forEach(((e,a)=>{e.x=t.x+(a-(o-1)/2)*r,e.y=t.y+i}))}));const d=s.append("g").selectAll("path.link").data(a.links()).enter().append("path").attr("class","link").attr("d",(t=>2===t.target.depth?`M${t.source.x},${t.source.y}L${t.source.x},${t.target.y}L${t.target.x},${t.target.y}`:`M${t.source.x},${t.source.y}L${t.target.x},${t.target.y}`)).attr("fill","none").attr("stroke","#555").attr("marker-end","url(#arrow)").each((function(){const t=this.getTotalLength();Le.Ltv(this).attr("stroke-dasharray",`${t} ${t}`).attr("stroke-dashoffset",t)}));d.transition().delay((t=>300*t.source.depth)).duration(600).attr("stroke-dashoffset",0).ease(Le.yfw);const c=t=>{const e=(t||"").split(/\s+/),o=[];for(let a=0;a<e.length;a+=3)o.push(e.slice(a,a+3).join(" "));return o},h=s.append("g").selectAll("g.node").data(a.descendants()).enter().append("g").attr("class","node").attr("transform",(t=>`translate(${t.x},${t.y})`)).attr("opacity",0);h.each((function(t){const e=Le.Ltv(this),o=c(t.data.name);let a,n,s;0===t.depth?(a=18,n=15,s=3):1===t.depth?(a=14,n=10,s=2):(a=10,n=6,s=1);const i=e.append("text").attr("text-anchor","middle").attr("dominant-baseline","middle").style("font-size",`${a}px`);o.forEach(((t,e)=>{i.append("tspan").attr("x",0).attr("dy",0===e?`-${.6*(o.length-1)}em`:"1.2em").text(t)}));const r=i.node().getBBox();e.insert("rect","text").attr("x",r.x-n).attr("y",r.y-n).attr("width",r.width+2*n).attr("height",r.height+2*n).attr("rx",n/2).attr("ry",n/2).attr("fill","white").attr("stroke","purple").attr("stroke-width",s)})),h.transition().delay((t=>300*t.depth+600)).duration(600).attr("opacity",1)},buildHierarchy(t){const e={name:t.root,children:[]};return(t.branches||[]).forEach((t=>{const o={name:t.title,children:[]};(t.subBranches||[]).forEach((t=>o.children.push({name:t}))),e.children.push(o)})),e}}};const Ke=(0,R.A)(Ye,[["render",Ge],["__scopeId","data-v-655a8440"]]);var Qe=Ke;const Ze={class:"login"},to={class:"signin_form"},eo={key:0,class:"error-msg"},oo={key:1,class:"modal-overlay",style:{display:"flex !important","z-index":"9999"}},ao={class:"modal"},no={key:0},so={key:1},io={key:2},ro={key:3,class:"error-msg"},lo={key:4,class:"success-msg"},co={class:"login_other"};function ho(t,e,o,s,i,d){const c=(0,n.g2)("router-link");return(0,n.uX)(),(0,n.CE)("div",Ze,[(0,n.Lk)("div",to,[e[22]||(e[22]=(0,n.Lk)("img",{src:l,alt:"Logo",class:"logo"},null,-1)),e[23]||(e[23]=(0,n.Lk)("br",null,null,-1)),(0,n.bo)((0,n.Lk)("input",{type:"email",name:"email",id:"email","onUpdate:modelValue":e[0]||(e[0]=t=>i.form.email=t),placeholder:"Nhập email của bạn"},null,512),[[a.Jo,i.form.email]]),e[24]||(e[24]=(0,n.Lk)("br",null,null,-1)),(0,n.bo)((0,n.Lk)("input",{type:"password",name:"pass",id:"pass","onUpdate:modelValue":e[1]||(e[1]=t=>i.form.pass=t),placeholder:"Nhập mật khẩu của bạn"},null,512),[[a.Jo,i.form.pass]]),e[25]||(e[25]=(0,n.Lk)("br",null,null,-1)),(0,n.Lk)("button",{type:"button",class:"submit",onClick:e[2]||(e[2]=(...t)=>d.signin&&d.signin(...t))},"Đăng nhập"),i.errorMessage?((0,n.uX)(),(0,n.CE)("p",eo,(0,r.v_)(i.errorMessage),1)):(0,n.Q3)("",!0),(0,n.Lk)("a",{href:"#",onClick:e[3]||(e[3]=(0,a.D$)(((...t)=>d.openModal&&d.openModal(...t)),["prevent"]))},"Quên mật khẩu?"),i.isModalOpen?((0,n.uX)(),(0,n.CE)("div",oo,[(0,n.Lk)("div",ao,[(0,n.Lk)("button",{class:"close",onClick:e[4]||(e[4]=(...t)=>d.closeModal&&d.closeModal(...t))},"×"),e[17]||(e[17]=(0,n.Lk)("h2",null,"Phục hồi mật khẩu",-1)),1===i.step?((0,n.uX)(),(0,n.CE)("div",no,[e[14]||(e[14]=(0,n.Lk)("p",null,"Nhập email của bạn:",-1)),(0,n.bo)((0,n.Lk)("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=t=>i.identifier=t),placeholder:"Email"},null,512),[[a.Jo,i.identifier]]),(0,n.Lk)("button",{onClick:e[6]||(e[6]=(...t)=>d.sendVerificationCode&&d.sendVerificationCode(...t))},"Gửi mã xác thực")])):(0,n.Q3)("",!0),2===i.step?((0,n.uX)(),(0,n.CE)("div",so,[e[15]||(e[15]=(0,n.Lk)("p",null,"Nhập mã xác thực đã nhận:",-1)),(0,n.bo)((0,n.Lk)("input",{type:"text","onUpdate:modelValue":e[7]||(e[7]=t=>i.code=t),placeholder:"Mã xác thực"},null,512),[[a.Jo,i.code]]),(0,n.Lk)("button",{onClick:e[8]||(e[8]=(...t)=>d.verifyCode&&d.verifyCode(...t))},"Xác thực mã")])):(0,n.Q3)("",!0),3===i.step?((0,n.uX)(),(0,n.CE)("div",io,[e[16]||(e[16]=(0,n.Lk)("p",null,"Nhập mật khẩu mới:",-1)),(0,n.bo)((0,n.Lk)("input",{type:"password","onUpdate:modelValue":e[9]||(e[9]=t=>i.newPassword=t),placeholder:"Mật khẩu mới"},null,512),[[a.Jo,i.newPassword]]),(0,n.bo)((0,n.Lk)("input",{type:"password","onUpdate:modelValue":e[10]||(e[10]=t=>i.confirmPassword=t),placeholder:"Nhập lại mật khẩu"},null,512),[[a.Jo,i.confirmPassword]]),(0,n.Lk)("button",{onClick:e[11]||(e[11]=(...t)=>d.resetPassword&&d.resetPassword(...t))},"Đặt lại mật khẩu")])):(0,n.Q3)("",!0),i.errorMessage?((0,n.uX)(),(0,n.CE)("p",ro,(0,r.v_)(i.errorMessage),1)):(0,n.Q3)("",!0),i.successMessage?((0,n.uX)(),(0,n.CE)("p",lo,(0,r.v_)(i.successMessage),1)):(0,n.Q3)("",!0)])])):(0,n.Q3)("",!0),(0,n.Lk)("p",null,[e[19]||(e[19]=(0,n.eW)("Chưa có tài khoản? ")),(0,n.bF)(c,{to:"/signup"},{default:(0,n.k6)((()=>e[18]||(e[18]=[(0,n.eW)("Đăng ký ngay")]))),_:1})]),(0,n.Lk)("div",co,[(0,n.Lk)("button",{class:"login_gg",onClick:e[12]||(e[12]=(...t)=>d.loginWithGoogle&&d.loginWithGoogle(...t))},e[20]||(e[20]=[(0,n.eW)(" Đăng nhập với Google "),(0,n.Lk)("i",{class:"fa-brands fa-google"},null,-1)])),(0,n.Lk)("button",{class:"login_fb",onClick:e[13]||(e[13]=(...t)=>d.loginWithFacebook&&d.loginWithFacebook(...t))},e[21]||(e[21]=[(0,n.eW)(" Đăng nhập với Facebook "),(0,n.Lk)("i",{class:"fa-brands fa-facebook"},null,-1)]))])])])}var uo={name:"SignIn",data(){return{form:{email:"",pass:""},errorMessage:"",isModalOpen:!1,step:1,identifier:"",code:"",newPassword:"",confirmPassword:"",userId:"",successMessage:""}},methods:{async signin(){this.errorMessage="";try{const t=await fetch("/signin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:this.form.email,pass:this.form.pass})}),e=await t.json();t.ok?(localStorage.setItem("token",e.token),localStorage.setItem("userName",e.user.name),localStorage.setItem("userIcon",e.user.photoURL),localStorage.setItem("provider","local"),F.token=e.token,F.userName=e.user.name,F.userIcon=e.user.photoURL,this.$router.push("/")):this.errorMessage=e.message}catch(t){console.error(t),this.errorMessage="Đã xảy ra lỗi!"}},async loginWithGoogle(){try{const t=await(0,z.df)(U,j),e=t.user,o=await e.getIdToken();localStorage.setItem("token",o),localStorage.setItem("provider","google"),localStorage.setItem("userName",e.displayName),localStorage.setItem("userEmail",e.email),localStorage.setItem("userIcon",e.photoURL);const a=await fetch("/saveUser",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uid:e.uid,name:e.displayName,email:e.email,photoURL:e.photoURL,provider:"google"})});console.log(a),F.token=localStorage.getItem("token"),F.userName=localStorage.getItem("userName"),F.userIcon=localStorage.getItem("userIcon"),this.$router.push("/")}catch(t){"auth/cancelled-popup-request"===t.code?this.errorMessage="Đăng nhập với Google bị hủy. Vui lòng thử lại.":"auth/popup-closed-by-user"===t.code?this.errorMessage="Bạn đã đóng cửa sổ đăng nhập. Vui lòng thử lại sau.":this.errorMessage=t.message}},async loginWithFacebook(){try{const t=await(0,z.df)(U,_);localStorage.setItem("provider","facebook");const e=t.user,o=await e.getIdToken();localStorage.setItem("token",o),localStorage.setItem("provider","facebook"),localStorage.setItem("userName",e.displayName),localStorage.setItem("userIcon",e.photoURL),localStorage.setItem("userEmail",e.email),await fetch("/api/auth/saveUser",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uid:e.uid,name:e.displayName,email:e.email,photoURL:e.photoURL,provider:"facebook"})}),F.token=localStorage.getItem("token"),F.userName=localStorage.getItem("userName"),F.userIcon=localStorage.getItem("userIcon"),this.$router.push("/")}catch(t){"auth/cancelled-popup-request"===t.code?this.errorMessage="Đăng nhập với Facebook bị hủy. Vui lòng thử lại.":"auth/popup-closed-by-user"===t.code?this.errorMessage="Bạn đã đóng cửa sổ đăng nhập. Vui lòng thử lại sau.":this.errorMessage=t.message}},openModal(){this.isModalOpen=!0,this.step=1,this.identifier="",this.code="",this.newPassword="",this.confirmPassword="",this.userId="",this.errorMessage="",this.successMessage=""},closeModal(){this.isModalOpen=!1},async sendVerificationCode(){this.errorMessage="";try{const t={email:this.identifier},e=await fetch("/api/auth/forgot-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),o=await e.json();e.ok?(this.successMessage=o.message,o.userId&&(this.userId=o.userId),this.step=2):this.errorMessage=o.message}catch(t){console.error(t),this.errorMessage="Đã xảy ra lỗi!"}},async verifyCode(){this.errorMessage="";try{const t=await fetch("/api/auth/verify-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:this.userId,code:this.code})}),e=await t.json();t.ok?(this.successMessage=e.message,this.step=3):this.errorMessage=e.message}catch(t){console.error(t),this.errorMessage="Đã xảy ra lỗi!"}},async resetPassword(){if(this.errorMessage="",this.newPassword===this.confirmPassword)try{const t=await fetch("/api/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:this.userId,code:this.code,newPassword:this.newPassword})}),e=await t.json();t.ok?(this.successMessage=e.message,setTimeout((()=>this.closeModal()),2e3)):this.errorMessage=e.message}catch(t){console.error(t),this.errorMessage="Đã xảy ra lỗi!"}else this.errorMessage="Mật khẩu xác nhận không khớp!"}}};const po=(0,R.A)(uo,[["render",ho],["__scopeId","data-v-34a71454"]]);var mo=po;const go={class:"login"},fo={class:"signin_form"},ko={key:0,class:"error-msg"},yo={class:"login_other"};function bo(t,e,o,s,i,d){return(0,n.uX)(),(0,n.CE)("div",go,[(0,n.Lk)("div",fo,[e[10]||(e[10]=(0,n.Lk)("img",{src:l,alt:"Logo",class:"logo"},null,-1)),e[11]||(e[11]=(0,n.Lk)("br",null,null,-1)),(0,n.bo)((0,n.Lk)("input",{type:"text",name:"name",id:"name","onUpdate:modelValue":e[0]||(e[0]=t=>i.form.name=t),placeholder:"Nhập họ và tên"},null,512),[[a.Jo,i.form.name]]),(0,n.bo)((0,n.Lk)("input",{type:"tel",name:"phone",id:"phone","onUpdate:modelValue":e[1]||(e[1]=t=>i.form.phone=t),placeholder:"Nhập số điện thoại"},null,512),[[a.Jo,i.form.phone]]),(0,n.bo)((0,n.Lk)("input",{type:"email",name:"email",id:"email","onUpdate:modelValue":e[2]||(e[2]=t=>i.form.email=t),placeholder:"Nhập email của bạn"},null,512),[[a.Jo,i.form.email]]),e[12]||(e[12]=(0,n.Lk)("br",null,null,-1)),(0,n.bo)((0,n.Lk)("input",{type:"password",name:"pass",id:"pass","onUpdate:modelValue":e[3]||(e[3]=t=>i.form.pass=t),placeholder:"Nhập mật khẩu của bạn"},null,512),[[a.Jo,i.form.pass]]),e[13]||(e[13]=(0,n.Lk)("br",null,null,-1)),(0,n.bo)((0,n.Lk)("input",{type:"password",name:"confirmPass",id:"confirmPass","onUpdate:modelValue":e[4]||(e[4]=t=>i.form.confirmPass=t),placeholder:"Nhập lại mật khẩu"},null,512),[[a.Jo,i.form.confirmPass]]),e[14]||(e[14]=(0,n.Lk)("br",null,null,-1)),(0,n.Lk)("button",{type:"button",class:"submit",onClick:e[5]||(e[5]=(0,a.D$)(((...t)=>d.signup&&d.signup(...t)),["prevent"]))},"Đăng Ký"),i.errorMessage?((0,n.uX)(),(0,n.CE)("p",ko,(0,r.v_)(i.errorMessage),1)):(0,n.Q3)("",!0),e[15]||(e[15]=(0,n.Lk)("p",null,[(0,n.eW)("Đã có tài khoản? "),(0,n.Lk)("a",{href:"/signin"},"Đăng nhập ngay")],-1)),(0,n.Lk)("div",yo,[(0,n.Lk)("button",{class:"login_gg",onClick:e[6]||(e[6]=(...t)=>d.loginWithGoogle&&d.loginWithGoogle(...t))},e[8]||(e[8]=[(0,n.eW)(" Google "),(0,n.Lk)("i",{class:"fa-brands fa-google"},null,-1)])),(0,n.Lk)("button",{class:"login_fb",onClick:e[7]||(e[7]=(...t)=>d.loginWithFacebook&&d.loginWithFacebook(...t))},e[9]||(e[9]=[(0,n.eW)("Facebook "),(0,n.Lk)("i",{class:"fa-brands fa-facebook"},null,-1)]))])])])}var xo={name:"SignUp",data(){return{form:{name:"",phone:"",email:"",pass:"",confirmPass:""},errorMessage:""}},methods:{async signup(){try{const t=await fetch("/api/auth/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:this.form.name,phone:this.form.phone,email:this.form.email,pass:this.form.pass,confirmPass:this.form.confirmPass})}),e=await t.json();t.ok?(alert(e.message),this.$router.push("/signin")):t.ok?(this.errorMessage="",this.$router.push("/signin")):this.errorMessage=e.message}catch(t){console.error(t),alert("Đã xảy ra lỗi!")}},async loginWithGoogle(){try{const t=await(0,z.df)(U,j),e=t.user,o=await e.getIdToken();localStorage.setItem("token",o),localStorage.setItem("provider","google"),localStorage.setItem("userName",e.displayName),localStorage.setItem("userEmail",e.email),localStorage.setItem("userIcon",e.photoURL);const a=await fetch("/saveUser",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uid:e.uid,name:e.displayName,email:e.email,photoURL:e.photoURL,provider:"google"})});console.log(a),F.token=localStorage.getItem("token"),F.userName=localStorage.getItem("userName"),F.userIcon=localStorage.getItem("userIcon"),this.$router.push("/")}catch(t){"auth/cancelled-popup-request"===t.code?this.errorMessage="Đăng nhập với Google bị hủy. Vui lòng thử lại.":"auth/popup-closed-by-user"===t.code?this.errorMessage="Bạn đã đóng cửa sổ đăng nhập. Vui lòng thử lại sau.":this.errorMessage=t.message}},async loginWithFacebook(){try{const t=await(0,z.df)(U,_);localStorage.setItem("provider","facebook");const e=t.user,o=await e.getIdToken();localStorage.setItem("token",o),localStorage.setItem("provider","facebook"),localStorage.setItem("userName",e.displayName),localStorage.setItem("userIcon",e.photoURL),localStorage.setItem("userEmail",e.email),await fetch("/api/auth/saveUser",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uid:e.uid,name:e.displayName,email:e.email,photoURL:e.photoURL,provider:"facebook"})}),F.token=localStorage.getItem("token"),F.userName=localStorage.getItem("userName"),F.userIcon=localStorage.getItem("userIcon"),this.$router.push("/")}catch(t){"auth/cancelled-popup-request"===t.code?this.errorMessage="Đăng nhập với Facebook bị hủy. Vui lòng thử lại.":"auth/popup-closed-by-user"===t.code?this.errorMessage="Bạn đã đóng cửa sổ đăng nhập. Vui lòng thử lại sau.":this.errorMessage=t.message}}}};const Lo=(0,R.A)(xo,[["render",bo],["__scopeId","data-v-3ffc7db1"]]);var vo=Lo;const wo=[{path:"/",component:ct},{path:"/listmm",component:Mt},{path:"/createmm",component:Ne},{path:"/createmm/edit/:id",component:Ne,props:!0},{path:"/createmmAI",component:Qe},{path:"/signin",component:mo},{path:"/signup",component:vo}],Co=(0,et.aE)({history:(0,et.LA)(),routes:wo});Co.beforeEach(((t,e,o)=>{const a=["/","/createMM","/signin","/signup"],n=!a.includes(t.path),s=localStorage.getItem("token");if(n&&!s)return o("/signin");o()}));var Mo=Co;const No=(0,tt.Ey)();(0,a.Ef)(Z).use(Mo).mount("#app"),(0,a.Ef)(Z).use(No)},9413:function(t,e,o){t.exports=o.p+"img/user-login.c0be67f6.jpg"}},e={};function o(a){var n=e[a];if(void 0!==n)return n.exports;var s=e[a]={exports:{}};return t[a].call(s.exports,s,s.exports,o),s.exports}o.m=t,function(){var t=[];o.O=function(e,a,n,s){if(!a){var i=1/0;for(c=0;c<t.length;c++){a=t[c][0],n=t[c][1],s=t[c][2];for(var r=!0,l=0;l<a.length;l++)(!1&s||i>=s)&&Object.keys(o.O).every((function(t){return o.O[t](a[l])}))?a.splice(l--,1):(r=!1,s<i&&(i=s));if(r){t.splice(c--,1);var d=n();void 0!==d&&(e=d)}}return e}s=s||0;for(var c=t.length;c>0&&t[c-1][2]>s;c--)t[c]=t[c-1];t[c]=[a,n,s]}}(),function(){o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,{a:e}),e}}(),function(){o.d=function(t,e){for(var a in e)o.o(e,a)&&!o.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){o.p="/"}(),function(){var t={524:0};o.O.j=function(e){return 0===t[e]};var e=function(e,a){var n,s,i=a[0],r=a[1],l=a[2],d=0;if(i.some((function(e){return 0!==t[e]}))){for(n in r)o.o(r,n)&&(o.m[n]=r[n]);if(l)var c=l(o)}for(e&&e(a);d<i.length;d++)s=i[d],o.o(t,s)&&t[s]&&t[s][0](),t[s]=0;return o.O(c)},a=self["webpackChunktmindmap"]=self["webpackChunktmindmap"]||[];a.forEach(e.bind(null,0)),a.push=e.bind(null,a.push.bind(a))}();var a=o.O(void 0,[504],(function(){return o(8245)}));a=o.O(a)})();
//# sourceMappingURL=app.8f23b918.js.map